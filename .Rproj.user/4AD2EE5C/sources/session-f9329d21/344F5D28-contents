---
title: "Indicadores Econômicos"
---

# Introdução

Este capítulo apresenta a análise econômica do programa de residência em Medicina de Família e Comunidade (MFC) no município de Esperança.

**Lógica de política pública de saúde:**

O município precisa investir em saúde. A pergunta não é "como gastar menos", mas sim:

1. **O modelo de residência é economicamente sustentável?**
2. **O investimento em formação e fixação se paga?**
3. **Quais são os benefícios econômicos além da formação?**

---

# Preparação

```{r}
#| label: setup
#| include: true
#| message: false
#| warning: false

options(scipen = 999, digits = 2, OutDec = ",")

formatar_numero <- function(x, decimais = 0) {
  format(round(x, decimais), big.mark = ".", decimal.mark = ",", nsmall = decimais)
}

formatar_moeda <- function(x) {
  paste0("R$ ", formatar_numero(x))
}
```

---

# Parâmetros do Modelo

## Município

```{r}
#| label: param-municipio

municipio <- list(
  nome = "Esperança",
  populacao = 500000,
  n_equipes = 100
)
```

- **Nome:** `r municipio$nome`
- **População:** `r formatar_numero(municipio$populacao)` habitantes
- **Equipes de APS:** `r municipio$n_equipes`

## Custos de Pessoal

```{r}
#| label: param-custos

custos_pessoal <- list(
  salario_base_medico = 16000,
  encargos_trabalhistas_pct = 0.70,
  adicional_preceptoria_pct = 0.10,
  bolsa_mec = 4106.90,
  complemento_ms = 4000.00,
  complemento_municipal = 2000.00
)

# Valores calculados
custos_pessoal$custo_medico_total <- custos_pessoal$salario_base_medico * 
                                      (1 + custos_pessoal$encargos_trabalhistas_pct)

custos_pessoal$adicional_preceptoria <- custos_pessoal$salario_base_medico * 
                                         custos_pessoal$adicional_preceptoria_pct

custos_pessoal$custo_preceptor_total <- custos_pessoal$custo_medico_total + 
                                         custos_pessoal$adicional_preceptoria * 
                                         (1 + custos_pessoal$encargos_trabalhistas_pct)

custos_pessoal$bolsa_total_mec_ms <- custos_pessoal$bolsa_mec + custos_pessoal$complemento_ms
```

```{r}
#| label: tabela-custos-pessoal

custos_tab <- data.frame(
  item = c(
    "Salário base médico ESF",
    "Encargos trabalhistas (70%)",
    "Custo total médico CLT",
    "Adicional preceptoria (10%)",
    "Custo total preceptor",
    "Bolsa residente (MEC + MS)"
  ),
  valor = c(
    custos_pessoal$salario_base_medico,
    custos_pessoal$salario_base_medico * custos_pessoal$encargos_trabalhistas_pct,
    custos_pessoal$custo_medico_total,
    custos_pessoal$adicional_preceptoria,
    custos_pessoal$custo_preceptor_total,
    custos_pessoal$bolsa_total_mec_ms
  )
)

custos_tab$valor_fmt <- formatar_moeda(custos_tab$valor)

knitr::kable(
  custos_tab[, c("item", "valor_fmt")],
  col.names = c("Item", "Valor Mensal"),
  caption = "Custos de pessoal"
)
```

## Programa de Residência

```{r}
#| label: param-programa

programa <- list(
  preceptores_ano1 = 4,
  preceptores_ano2 = 8,
  equipes_por_preceptor = 2,
  residentes_por_equipe = 2,
  taxa_retencao = 0.60,
  custo_operacional_anual = 50000,
  incentivo_equipe_residente = 4500
)

# Valores calculados
programa$equipes_escola_ano1 <- programa$preceptores_ano1 * programa$equipes_por_preceptor
programa$equipes_escola_ano2 <- programa$preceptores_ano2 * programa$equipes_por_preceptor
programa$residentes_ano1 <- programa$equipes_escola_ano1 * programa$residentes_por_equipe
programa$residentes_ano2 <- programa$equipes_escola_ano2 * programa$residentes_por_equipe
programa$vagas_por_ano <- programa$residentes_ano2 / 2
```

| Parâmetro | Ano 1 | Ano 2+ |
|-----------|-------|--------|
| Preceptores | `r programa$preceptores_ano1` | `r programa$preceptores_ano2` |
| Equipes-escola | `r programa$equipes_escola_ano1` | `r programa$equipes_escola_ano2` |
| Residentes | `r programa$residentes_ano1` | `r programa$residentes_ano2` |
| Taxa de retenção | `r programa$taxa_retencao * 100`% | `r programa$taxa_retencao * 100`% |

## Parâmetros Econômicos

```{r}
#| label: param-economico

economico <- list(
  taxa_desconto = 0.05,
  horizonte_anos = 10,
  fator_correcao_aih = 1.5
)
```

- **Taxa de desconto:** `r economico$taxa_desconto * 100`% ao ano
- **Horizonte de análise:** `r economico$horizonte_anos` anos
- **Fator de correção AIH:** `r economico$fator_correcao_aih`

---

# Economia do Modelo de Residência

O modelo de residência gera economia porque **1 preceptor cuida de 2 equipes** com apoio de 4 residentes, enquanto o modelo tradicional precisaria de **2 médicos**.

```{r}
#| label: economia-modelo

# Modelo tradicional: 2 médicos para 2 equipes
custo_tradicional_2eq <- 2 * custos_pessoal$custo_medico_total * 12

# Modelo residência: 1 preceptor + 4 residentes - incentivo federal
custo_residencia_2eq <- custos_pessoal$custo_preceptor_total * 12 +
                         4 * custos_pessoal$bolsa_total_mec_ms * 12 -
                         2 * programa$incentivo_equipe_residente * 12

economia_por_par <- custo_tradicional_2eq - custo_residencia_2eq

comparativo <- data.frame(
  item = c(
    "MODELO TRADICIONAL (2 equipes)",
    "  2 médicos CLT × 12 meses",
    "",
    "MODELO RESIDÊNCIA (2 equipes)",
    "  1 preceptor × 12 meses",
    "  4 residentes × 12 meses",
    "  (-) Incentivo federal",
    "  Custo líquido",
    "",
    "ECONOMIA ANUAL DO MODELO"
  ),
  valor = c(
    custo_tradicional_2eq,
    custo_tradicional_2eq,
    NA,
    NA,
    custos_pessoal$custo_preceptor_total * 12,
    4 * custos_pessoal$bolsa_total_mec_ms * 12,
    -2 * programa$incentivo_equipe_residente * 12,
    custo_residencia_2eq,
    NA,
    economia_por_par
  )
)

comparativo$valor_fmt <- ifelse(is.na(comparativo$valor), "", formatar_moeda(comparativo$valor))

knitr::kable(
  comparativo[, c("item", "valor_fmt")],
  col.names = c("Item", "Valor Anual"),
  caption = "Comparativo: modelo tradicional vs. residência (por 2 equipes)"
)
```

**Resultado:** Para cada par de equipes-escola, o modelo de residência gera economia de `r formatar_moeda(economia_por_par)` por ano.

---

# Função de Economia em Saúde

```{r}
#| label: funcao-economia

converter_para_baseline <- function(valor_observado, rr, 
                                     prop_mfc = 0.336, prop_gen = 0.664,
                                     pop_estudo = 600000, pop_alvo = 500000) {
  denominador <- (prop_mfc * rr) + prop_gen
  taxa_baseline_600k <- valor_observado / denominador
  taxa_baseline_500k <- taxa_baseline_600k * (pop_alvo / pop_estudo)
  return(taxa_baseline_500k)
}

calcular_economia_100pct <- function(fator_aih = 1.5) {
  custo_consulta <- 50.00
  
  # Encaminhamentos ambulatoriais
  enc_amb <- data.frame(
    rr = c(0.40, 0.50, 0.45, 0.49, 0.54, 0.74, 0.57, 0.54,
           0.63, 0.42, 0.38, 0.35, 0.47, 1.17, 1.68, 1.09,
           0.71, 0.52, 0.86, 0.66),
    obs = c(2008, 1835, 897, 4144, 903, 290, 1762, 480,
            603, 1021, 867, 1030, 830, 2390, 1173, 8713,
            2269, 4934, 738, 991)
  )
  enc_amb$baseline <- mapply(converter_para_baseline, enc_amb$obs, enc_amb$rr)
  enc_amb$economia <- enc_amb$baseline * (1 - enc_amb$rr) * custo_consulta
  
  # Encaminhamentos cirúrgicos
  enc_cir <- data.frame(
    rr = c(1.21, 0.87, 1.22, 0.91, 1.19, 0.87),
    obs = c(4458, 989, 147, 1968, 859, 359)
  )
  enc_cir$baseline <- mapply(converter_para_baseline, enc_cir$obs, enc_cir$rr)
  enc_cir$economia <- enc_cir$baseline * (1 - enc_cir$rr) * custo_consulta
  
  # Exames diagnósticos
  diag <- data.frame(
    rr = c(0.66, 0.96, 0.76, 0.49, 0.72, 0.98),
    obs = c(1201, 385, 510, 1090, 431, 2424),
    custo = c(39.94, 13.20, 86.00, 48.16, 30.00, 45.00)
  )
  diag$baseline <- mapply(converter_para_baseline, diag$obs, diag$rr)
  diag$economia <- diag$baseline * (1 - diag$rr) * diag$custo
  
  # Exames laboratoriais
  lab <- data.frame(
    rr = c(0.53, 0.85, 0.29, 0.42, 0.73, 0.46, 0.64, 0.81, 0.94, 0.41, 0.82,
           0.23, 0.71, 0.08, 0.13, 0.56, 0.78, 0.48, 0.47, 0.69, 0.64, 0.74,
           0.09, 0.67, 0.44, 0.56, 0.60, 0.48, 0.47, 0.36),
    obs = c(51757, 43746, 22577, 10517, 18265, 9072, 25720, 34673, 
            31127, 22163, 33828, 15603, 11679, 791, 886, 5432, 
            2304, 9181, 9363, 3505, 4386, 1957, 604, 41333, 
            1866, 674, 863, 210, 216, 4365),
    custo = c(4.11, 1.85, 1.85, 1.85, 1.85, 1.85, 7.86, 1.85, 3.51, 3.51, 3.51,
              1.85, 8.96, 8.71, 8.71, 11.60, 2.01, 2.01, 2.01, 2.01, 3.51, 2.63, 
              1.65, 3.70, 1.85, 10.15, 10.15, 18.55, 18.55, 16.42)
  )
  lab$baseline <- mapply(converter_para_baseline, lab$obs, lab$rr)
  lab$economia <- lab$baseline * (1 - lab$rr) * lab$custo
  
  # Internações ICSAP
  icsap <- data.frame(
    rr = c(0.83, 0.76, 0.74, 0.62, 0.52, 0.79, 0.35, 0.78, 
           0.45, 0.57, 0.36, 0.82, 1.06, 0.59),
    obs = c(128, 160, 244, 271, 230, 86, 54, 136, 
            45, 114, 116, 331, 28, 41),
    custo = c(761.35, 1178.17, 1756.62, 4774.49, 2553.91, 957.47, 853.21, 646.69,
              527.15, 1969.07, 1969.07, 679.82, 502.60, 612.67)
  )
  icsap$baseline <- mapply(converter_para_baseline, icsap$obs, icsap$rr)
  icsap$economia <- icsap$baseline * (1 - icsap$rr) * icsap$custo * fator_aih
  
  total <- sum(enc_amb$economia) + sum(enc_cir$economia) + 
           sum(diag$economia) + sum(lab$economia) + sum(icsap$economia)
  return(total)
}

economia_100pct <- calcular_economia_100pct(economico$fator_correcao_aih)
```

**Economia potencial com 100% de cobertura MFC:** `r formatar_moeda(economia_100pct)` por ano.

---

# Simulação do Programa

```{r}
#| label: simulacao

simular_programa <- function(
    taxa_retencao = 0.60,
    adicional_especialidade_pct = 0.10,
    fator_correcao_aih = 1.5
) {
  
  anos <- 0:economico$horizonte_anos
  n_anos <- length(anos)
  
  # Vetores de evolução
  n_preceptores <- c(0, 4, rep(8, 9))
  n_equipes_escola <- c(0, 8, rep(16, 9))
  n_residentes <- c(0, 16, rep(32, 9))
  
  # Formados retidos acumulados
  n_formados_retidos_acum <- numeric(n_anos)
  for (i in 4:n_anos) {
    if (i == 4) {
      n_formados_retidos_acum[i] <- round(16 * taxa_retencao)
    } else {
      n_formados_retidos_acum[i] <- n_formados_retidos_acum[i-1] + round(16 * taxa_retencao)
    }
  }
  
  # Cobertura MFC
  n_equipes_mfc <- pmin(n_equipes_escola + n_formados_retidos_acum, 100)
  prop_mfc <- n_equipes_mfc / 100
  
  # Economia do modelo de residência
  custo_2med <- 2 * custos_pessoal$custo_medico_total * 12
  custo_1prec_4res <- custos_pessoal$custo_preceptor_total * 12 +
                       4 * custos_pessoal$bolsa_total_mec_ms * 12 -
                       2 * programa$incentivo_equipe_residente * 12
  economia_por_par <- custo_2med - custo_1prec_4res
  economia_modelo <- (n_equipes_escola / 2) * economia_por_par
  
  # Investimento em fixação (adicional por especialidade)
  adicional_mensal <- custos_pessoal$salario_base_medico * adicional_especialidade_pct
  investimento_fixacao <- n_formados_retidos_acum * adicional_mensal * 
                           (1 + custos_pessoal$encargos_trabalhistas_pct) * 12
  
  # Custo operacional
  custo_operacional <- c(0, rep(programa$custo_operacional_anual, 10))
  
  # Economia líquida de pessoal
  economia_pessoal <- economia_modelo - investimento_fixacao - custo_operacional
  
  # Benefício em saúde
  economia_100pct <- calcular_economia_100pct(fator_correcao_aih)
  beneficio_saude <- economia_100pct * prop_mfc
  
  # Saldo total
  saldo <- economia_pessoal + beneficio_saude
  
  # Valor presente
  fator_vp <- 1 / ((1 + economico$taxa_desconto) ^ anos)
  saldo_vp <- saldo * fator_vp
  vpl <- sum(saldo_vp)
  
  return(list(
    vpl = vpl,
    cobertura_final = prop_mfc[n_anos],
    formados_final = n_formados_retidos_acum[n_anos],
    economia_modelo_total = sum(economia_modelo),
    investimento_fixacao_total = sum(investimento_fixacao),
    beneficio_saude_total = sum(beneficio_saude),
    dados = data.frame(
      ano = anos,
      preceptores = n_preceptores,
      equipes_escola = n_equipes_escola,
      residentes = n_residentes,
      formados_acum = n_formados_retidos_acum,
      equipes_mfc = n_equipes_mfc,
      prop_mfc = prop_mfc,
      economia_modelo = economia_modelo,
      investimento_fixacao = investimento_fixacao,
      custo_operacional = custo_operacional,
      economia_pessoal = economia_pessoal,
      beneficio_saude = beneficio_saude,
      saldo = saldo,
      saldo_vp = saldo_vp
    )
  ))
}

resultado <- simular_programa(
  taxa_retencao = programa$taxa_retencao,
  adicional_especialidade_pct = 0.10
)
```

---

# Evolução do Programa

```{r}
#| label: evolucao

evolucao <- data.frame(
  ano = resultado$dados$ano,
  preceptores = resultado$dados$preceptores,
  equipes_escola = resultado$dados$equipes_escola,
  residentes = resultado$dados$residentes,
  formados = resultado$dados$formados_acum,
  cobertura = paste0(round(resultado$dados$prop_mfc * 100, 0), "%")
)

knitr::kable(
  evolucao,
  col.names = c("Ano", "Preceptores", "Equipes-Escola", "Residentes", "Formados Retidos", "Cobertura MFC"),
  caption = "Evolução do programa ao longo de 10 anos"
)
```

---

# Fluxo de Caixa

```{r}
#| label: fluxo-caixa

fluxo <- data.frame(
  ano = resultado$dados$ano,
  economia_modelo = round(resultado$dados$economia_modelo / 1000, 1),
  invest_fixacao = round(resultado$dados$investimento_fixacao / 1000, 1),
  custo_operac = round(resultado$dados$custo_operacional / 1000, 1),
  economia_pessoal = round(resultado$dados$economia_pessoal / 1000, 1),
  beneficio_saude = round(resultado$dados$beneficio_saude / 1000, 1),
  saldo = round(resultado$dados$saldo / 1000, 1)
)

knitr::kable(
  fluxo,
  col.names = c("Ano", "Econ. Modelo", "(-) Invest. Fixação", "(-) Operacional", 
                "Econ. Pessoal", "Benef. Saúde", "Saldo"),
  caption = "Fluxo de caixa anual (R$ mil)"
)
```

**Legenda:**

- **Economia do modelo:** Diferença entre custo tradicional e modelo de residência
- **Investimento em fixação:** Adicional por especialidade para reter formados
- **Operacional:** Custos administrativos do programa
- **Economia de pessoal:** Resultado líquido (economia modelo - investimentos)
- **Benefício em saúde:** Economia com exames, encaminhamentos e internações
- **Saldo:** Resultado total do ano

---

# Indicadores Econômicos

```{r}
#| label: indicadores

indicadores <- data.frame(
  indicador = c(
    "Cobertura MFC final",
    "Formados retidos (10 anos)",
    "Economia do modelo (10 anos)",
    "Investimento em fixação (10 anos)",
    "Benefício em saúde (10 anos)",
    "VPL (economia total)",
    "Payback"
  ),
  valor = c(
    paste0(round(resultado$cobertura_final * 100, 0), "%"),
    resultado$formados_final,
    formatar_moeda(resultado$economia_modelo_total),
    formatar_moeda(resultado$investimento_fixacao_total),
    formatar_moeda(resultado$beneficio_saude_total),
    formatar_moeda(resultado$vpl),
    "Ano 1 (imediato)"
  )
)

knitr::kable(
  indicadores,
  col.names = c("Indicador", "Valor"),
  caption = "Indicadores econômicos do programa"
)
```

---

# Conclusões

O programa de residência em MFC é **economicamente viável** e se paga desde o primeiro ano.

**Principais resultados em 10 anos:**

- **Cobertura MFC:** `r round(resultado$cobertura_final * 100, 0)`% das equipes
- **Formados retidos:** `r resultado$formados_final` médicos de família
- **VPL:** `r formatar_moeda(resultado$vpl)`

**Por que o programa é viável?**

1. O modelo de residência é mais barato que o tradicional
2. O investimento em fixação (adicional 10%) é compensado pela economia em saúde
3. A economia em saúde cresce conforme a cobertura MFC aumenta
