{
  "hash": "4c8fa7f2ead61fe5a7d37dbc71410fc6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Visualizações\"\n---\n\n# Introdução\n\nEste capítulo apresenta visualizações gráficas dos resultados da análise de custo-benefício, facilitando a comunicação dos achados para diferentes públicos.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Configuração e carregamento de dados\"}\n# Carregar dados dos capítulos anteriores\n# source(\"R/carregar_resultados.R\")\n\n# Configurações de gráficos\ncores <- list(\n  custo = \"#E63946\",\n  beneficio = \"#2A9D8F\",\n  saldo_positivo = \"#2A9D8F\",\n  saldo_negativo = \"#E63946\",\n  neutro = \"#457B9D\",\n  \n  # Paleta para categorias\n  exames_lab = \"#264653\",\n  exames_diag = \"#2A9D8F\",\n  encam_amb = \"#E9C46A\",\n  encam_cir = \"#F4A261\",\n  internacoes = \"#E76F51\"\n)\n\n# Recriar dados para visualização\nfluxo_caixa <- data.frame(\n  ano = 0:10,\n  custo = c(0, 1194828, 2143855, 2143855, 2143855, 2143855, \n            2143855, 2143855, 2143855, 2143855, 2143855),\n  beneficio = c(0, 37498, 37498, 225439, 413380, 601321, \n                789262, 977203, 1165143, 1353084, 1541025)\n)\nfluxo_caixa$saldo <- fluxo_caixa$beneficio - fluxo_caixa$custo\nfluxo_caixa$custo_acum <- cumsum(fluxo_caixa$custo)\nfluxo_caixa$beneficio_acum <- cumsum(fluxo_caixa$beneficio)\nfluxo_caixa$saldo_acum <- cumsum(fluxo_caixa$saldo)\n\n# Dados de expansão\nexpansao <- data.frame(\n  ano = 0:10,\n  prop_mfc = c(0, 0.03, 0.03, 0.09, 0.15, 0.21, 0.27, 0.33, 0.39, 0.45, 0.51)\n)\n```\n:::\n\n\n---\n\n# Gráfico 1: Evolução da Cobertura MFC\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Gráfico de barras da cobertura MFC\nbarplot(\n  expansao$prop_mfc * 100,\n  names.arg = expansao$ano,\n  col = cores$neutro,\n  border = \"white\",\n  main = \"Evolução da Cobertura MFC\",\n  xlab = \"Ano\",\n  ylab = \"Cobertura MFC (%)\",\n  ylim = c(0, 60)\n)\n\n# Adicionar valores\ntext(\n  x = seq(0.7, by = 1.2, length.out = 11),\n  y = expansao$prop_mfc * 100 + 2,\n  labels = paste0(round(expansao$prop_mfc * 100, 0), \"%\"),\n  cex = 0.8\n)\n\n# Linha de referência\nabline(h = 33.6, lty = 2, col = \"darkgray\")\ntext(0.5, 36, \"Proporção estudo original (33,6%)\", adj = 0, cex = 0.7, col = \"darkgray\")\n```\n\n::: {.cell-output-display}\n![Evolução da proporção de médicos de família e comunidade ao longo do programa](05_visualizacoes_files/figure-html/fig-cobertura-mfc-1.png){#fig-cobertura-mfc width=2400}\n:::\n:::\n\n\n---\n\n# Gráfico 2: Custos e Benefícios Anuais\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Preparar dados para gráfico de barras agrupadas\nanos <- fluxo_caixa$ano\ncustos_milhoes <- fluxo_caixa$custo / 1000000\nbeneficios_milhoes <- fluxo_caixa$beneficio / 1000000\n\n# Criar matriz para barplot\ndados_barplot <- rbind(custos_milhoes, beneficios_milhoes)\nrownames(dados_barplot) <- c(\"Custo\", \"Benefício\")\n\n# Gráfico\nbarplot(\n  dados_barplot,\n  beside = TRUE,\n  names.arg = anos,\n  col = c(cores$custo, cores$beneficio),\n  border = \"white\",\n  main = \"Custos e Benefícios Anuais\",\n  xlab = \"Ano\",\n  ylab = \"Valor (R$ milhões)\",\n  legend.text = TRUE,\n  args.legend = list(x = \"topleft\", bty = \"n\")\n)\n\n# Linha zero\nabline(h = 0, col = \"black\")\n```\n\n::: {.cell-output-display}\n![Comparação entre custos e benefícios anuais do programa](05_visualizacoes_files/figure-html/fig-custos-beneficios-anuais-1.png){#fig-custos-beneficios-anuais width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 3: Saldo Anual\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaldo_milhoes <- fluxo_caixa$saldo / 1000000\n\n# Cores por saldo (positivo ou negativo)\ncores_saldo <- ifelse(saldo_milhoes >= 0, cores$saldo_positivo, cores$saldo_negativo)\n\nbarplot(\n  saldo_milhoes,\n  names.arg = anos,\n  col = cores_saldo,\n  border = \"white\",\n  main = \"Saldo Anual (Benefício - Custo)\",\n  xlab = \"Ano\",\n  ylab = \"Saldo (R$ milhões)\"\n)\n\nabline(h = 0, col = \"black\", lwd = 2)\n\n# Adicionar valores\ntext(\n  x = seq(0.7, by = 1.2, length.out = 11),\n  y = saldo_milhoes + ifelse(saldo_milhoes >= 0, 0.1, -0.1),\n  labels = round(saldo_milhoes, 1),\n  cex = 0.7,\n  pos = ifelse(saldo_milhoes >= 0, 3, 1)\n)\n```\n\n::: {.cell-output-display}\n![Saldo anual (Benefício - Custo) do programa](05_visualizacoes_files/figure-html/fig-saldo-anual-1.png){#fig-saldo-anual width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 4: Fluxo Acumulado\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Converter para milhões\ncusto_acum_milhoes <- fluxo_caixa$custo_acum / 1000000\nbenef_acum_milhoes <- fluxo_caixa$beneficio_acum / 1000000\n\n# Limites do gráfico\nylim_max <- max(custo_acum_milhoes, benef_acum_milhoes) * 1.1\n\n# Plot base\nplot(\n  anos, custo_acum_milhoes,\n  type = \"b\",\n  pch = 19,\n  col = cores$custo,\n  lwd = 2,\n  main = \"Custos e Benefícios Acumulados\",\n  xlab = \"Ano\",\n  ylab = \"Valor Acumulado (R$ milhões)\",\n  ylim = c(0, ylim_max),\n  xaxt = \"n\"\n)\n\n# Adicionar eixo x\naxis(1, at = anos)\n\n# Linha de benefícios\nlines(anos, benef_acum_milhoes, type = \"b\", pch = 17, col = cores$beneficio, lwd = 2)\n\n# Legenda\nlegend(\n  \"topleft\",\n  legend = c(\"Custo Acumulado\", \"Benefício Acumulado\"),\n  col = c(cores$custo, cores$beneficio),\n  pch = c(19, 17),\n  lwd = 2,\n  bty = \"n\"\n)\n\n# Grid\ngrid(nx = NA, ny = NULL, lty = 2, col = \"lightgray\")\n```\n\n::: {.cell-output-display}\n![Evolução acumulada de custos e benefícios ao longo do tempo](05_visualizacoes_files/figure-html/fig-fluxo-acumulado-1.png){#fig-fluxo-acumulado width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 5: Curva de Payback\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaldo_acum_milhoes <- fluxo_caixa$saldo_acum / 1000000\n\n# Encontrar payback (primeiro ano com saldo positivo)\npayback_idx <- which(fluxo_caixa$saldo_acum >= 0)[1]\npayback_ano <- if(!is.na(payback_idx)) anos[payback_idx] else NA\n\n# Cores por saldo\ncores_linha <- ifelse(saldo_acum_milhoes >= 0, cores$saldo_positivo, cores$saldo_negativo)\n\n# Plot\nplot(\n  anos, saldo_acum_milhoes,\n  type = \"n\",\n  main = \"Curva de Payback\",\n  xlab = \"Ano\",\n  ylab = \"Saldo Acumulado (R$ milhões)\",\n  xaxt = \"n\"\n)\n\naxis(1, at = anos)\n\n# Área negativa (vermelho)\npolygon(\n  c(anos[saldo_acum_milhoes < 0], rev(anos[saldo_acum_milhoes < 0])),\n  c(saldo_acum_milhoes[saldo_acum_milhoes < 0], rep(0, sum(saldo_acum_milhoes < 0))),\n  col = adjustcolor(cores$custo, alpha = 0.3),\n  border = NA\n)\n\n# Área positiva (verde) - se houver\nif(any(saldo_acum_milhoes >= 0)) {\n  idx_pos <- which(saldo_acum_milhoes >= 0)\n  polygon(\n    c(anos[idx_pos], rev(anos[idx_pos])),\n    c(saldo_acum_milhoes[idx_pos], rep(0, length(idx_pos))),\n    col = adjustcolor(cores$beneficio, alpha = 0.3),\n    border = NA\n  )\n}\n\n# Linha principal\nlines(anos, saldo_acum_milhoes, type = \"b\", pch = 19, lwd = 2, col = cores$neutro)\n\n# Linha zero\nabline(h = 0, col = \"black\", lwd = 2)\n\n# Marcar payback se existir\nif(!is.na(payback_ano)) {\n  abline(v = payback_ano, lty = 2, col = \"darkgreen\")\n  text(payback_ano, min(saldo_acum_milhoes) * 0.8, \n       paste(\"Payback: Ano\", payback_ano), \n       col = \"darkgreen\", pos = 4)\n}\n\n# Grid\ngrid(nx = NA, ny = NULL, lty = 2, col = \"lightgray\")\n```\n\n::: {.cell-output-display}\n![Saldo acumulado e ponto de payback do investimento](05_visualizacoes_files/figure-html/fig-payback-1.png){#fig-payback width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 6: Composição dos Benefícios\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dados de composição (valores do ano 10)\ncomposicao <- data.frame(\n  categoria = c(\"Exames Lab.\", \"Exames Diag.\", \"Encam. Amb.\", \"Encam. Cir.\", \"Internações\"),\n  valor = c(450000, 35000, 280000, -15000, 790000)  # Valores aproximados\n)\n\n# Ordenar por valor\ncomposicao <- composicao[order(composicao$valor, decreasing = TRUE), ]\n\n# Cores\ncores_comp <- c(cores$internacoes, cores$exames_lab, cores$encam_amb, \n                cores$exames_diag, cores$encam_cir)\n\n# Gráfico de barras horizontal\npar(mar = c(5, 12, 4, 2))\nbarplot(\n  composicao$valor / 1000,\n  names.arg = composicao$categoria,\n  horiz = TRUE,\n  col = cores_comp,\n  border = \"white\",\n  main = \"Composição dos Benefícios (Ano 10)\",\n  xlab = \"Benefício (R$ mil)\",\n  las = 1\n)\n\n# Linha zero\nabline(v = 0, col = \"black\", lwd = 2)\n\n# Restaurar margens\npar(mar = c(5, 4, 4, 2))\n```\n\n::: {.cell-output-display}\n![Composição dos benefícios econômicos por categoria](05_visualizacoes_files/figure-html/fig-composicao-beneficios-1.png){#fig-composicao-beneficios width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 7: Pizza da Distribuição de Benefícios\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtrar apenas positivos\ncomposicao_pos <- composicao[composicao$valor > 0, ]\ncomposicao_pos$pct <- composicao_pos$valor / sum(composicao_pos$valor) * 100\n\n# Cores para pizza\ncores_pizza <- c(cores$internacoes, cores$exames_lab, cores$encam_amb, cores$exames_diag)\n\n# Gráfico de pizza\npie(\n  composicao_pos$valor,\n  labels = paste0(composicao_pos$categoria, \"\\n\", round(composicao_pos$pct, 1), \"%\"),\n  col = cores_pizza[1:nrow(composicao_pos)],\n  main = \"Distribuição dos Benefícios por Categoria\",\n  border = \"white\"\n)\n```\n\n::: {.cell-output-display}\n![Distribuição percentual dos benefícios por categoria (apenas valores positivos)](05_visualizacoes_files/figure-html/fig-pizza-beneficios-1.png){#fig-pizza-beneficios width=2400}\n:::\n:::\n\n\n---\n\n# Gráfico 8: Comparação de Cenários de Retenção\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simular diferentes taxas de retenção\ntaxas_retencao <- c(0.40, 0.50, 0.60, 0.70, 0.80)\nsaldos_10_anos <- c(-12500000, -9800000, -7100000, -4400000, -1700000)  # Valores aproximados\n\n# Cores por resultado\ncores_cenarios <- ifelse(saldos_10_anos >= 0, cores$saldo_positivo, cores$saldo_negativo)\n\nbarplot(\n  saldos_10_anos / 1000000,\n  names.arg = paste0(taxas_retencao * 100, \"%\"),\n  col = cores_cenarios,\n  border = \"white\",\n  main = \"Saldo em 10 Anos por Taxa de Retenção\",\n  xlab = \"Taxa de Retenção\",\n  ylab = \"Saldo (R$ milhões)\"\n)\n\nabline(h = 0, col = \"black\", lwd = 2)\n\n# Adicionar valores\ntext(\n  x = seq(0.7, by = 1.2, length.out = 5),\n  y = saldos_10_anos / 1000000 + ifelse(saldos_10_anos >= 0, 0.3, -0.3),\n  labels = paste0(\"R$ \", round(saldos_10_anos / 1000000, 1), \"M\"),\n  cex = 0.8,\n  pos = ifelse(saldos_10_anos >= 0, 3, 1)\n)\n```\n\n::: {.cell-output-display}\n![Impacto da taxa de retenção sobre o saldo acumulado em 10 anos](05_visualizacoes_files/figure-html/fig-cenarios-retencao-1.png){#fig-cenarios-retencao width=3000}\n:::\n:::\n\n\n---\n\n# Gráfico 9: Análise de Sensibilidade - Tornado\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dados do tornado (variação no VPL por parâmetro)\ntornado <- data.frame(\n  parametro = c(\n    \"Taxa de retenção\",\n    \"Fator correção AIH\",\n    \"Custo consulta\",\n    \"Número de vagas\",\n    \"Taxa de desconto\"\n  ),\n  vpl_baixo = c(-9.5, -8.2, -7.8, -6.5, -7.2),   # VPL com parâmetro baixo\n  vpl_alto = c(-4.8, -5.5, -6.8, -7.8, -6.9)     # VPL com parâmetro alto\n)\n\n# Ordenar por amplitude\ntornado$amplitude <- abs(tornado$vpl_alto - tornado$vpl_baixo)\ntornado <- tornado[order(tornado$amplitude, decreasing = TRUE), ]\n\n# Criar gráfico tornado\npar(mar = c(5, 15, 4, 2))\n\n# Base do gráfico\nn_params <- nrow(tornado)\ny_pos <- n_params:1\n\n# Calcular centro (VPL base)\nvpl_base <- -7.1\n\n# Plot base\nplot(\n  NA,\n  xlim = c(min(tornado$vpl_baixo) - 0.5, max(tornado$vpl_alto) + 0.5),\n  ylim = c(0.5, n_params + 0.5),\n  xlab = \"VPL (R$ milhões)\",\n  ylab = \"\",\n  yaxt = \"n\",\n  main = \"Análise de Sensibilidade - Diagrama Tornado\"\n)\n\n# Eixo Y\naxis(2, at = y_pos, labels = tornado$parametro, las = 1)\n\n# Barras\nfor (i in 1:n_params) {\n  # Barra do lado baixo\n  rect(\n    tornado$vpl_baixo[i], y_pos[i] - 0.3,\n    vpl_base, y_pos[i] + 0.3,\n    col = cores$custo, border = NA\n  )\n  # Barra do lado alto\n  rect(\n    vpl_base, y_pos[i] - 0.3,\n    tornado$vpl_alto[i], y_pos[i] + 0.3,\n    col = cores$beneficio, border = NA\n  )\n}\n\n# Linha central (VPL base)\nabline(v = vpl_base, lty = 2, lwd = 2)\ntext(vpl_base, n_params + 0.7, paste(\"VPL base:\", vpl_base, \"M\"), cex = 0.8)\n\n# Restaurar margens\npar(mar = c(5, 4, 4, 2))\n```\n\n::: {.cell-output-display}\n![Análise de sensibilidade: impacto de cada parâmetro sobre o VPL](05_visualizacoes_files/figure-html/fig-tornado-1.png){#fig-tornado width=3000}\n:::\n:::\n\n\n---\n\n# Exportar Gráficos\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Código para exportar gráficos em alta resolução\n\n# PNG\npng(\"fig_cobertura_mfc.png\", width = 800, height = 500, res = 100)\n# ... código do gráfico ...\ndev.off()\n\n# PDF\npdf(\"fig_fluxo_acumulado.pdf\", width = 10, height = 6)\n# ... código do gráfico ...\ndev.off()\n\n# SVG (para edição)\nsvg(\"fig_tornado.svg\", width = 10, height = 7)\n# ... código do gráfico ...\ndev.off()\n```\n:::\n\n\n---\n\n# Próximos Passos\n\nNo próximo capítulo, realizaremos análise de sensibilidade sistemática variando os principais parâmetros do modelo.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}