{
  "hash": "c703789986e241eee68948ddba4c47cf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Funções de Simulação\"\n---\n\n# Introdução\n\nEste capítulo apresenta as funções R que serão utilizadas para simular o impacto econômico do programa de residência em MFC. \n\n**Objetivo:** Criar um conjunto de ferramentas que nos permitam responder perguntas como:\n\n- Se aumentarmos a cobertura de MFC de 0% para 50%, quantos exames deixarão de ser solicitados?\n- Quanto dinheiro será economizado com a redução de internações?\n- Em quantos anos o investimento no programa se paga?\n\nAntes de cada função, explicarei **o conceito por trás dela**, **para que serve** e **como interpretar os resultados**.\n\n---\n\n# Preparação: Carregar Dados do Capítulo Anterior\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Configurações\noptions(scipen = 999, digits = 2, OutDec = \",\")\n\n# Função auxiliar para formatar números\nformatar_numero <- function(x, decimais = 0) {\n  format(round(x, decimais), big.mark = \".\", decimal.mark = \",\", nsmall = decimais)\n}\n\n# ============================================================\n# NOTA: Em uso real, você carregaria os dados do capítulo 1\n# usando: source(\"R/01_dados.R\") ou load(\"dados_capitulo1.RData\")\n# \n# Para este documento ser autocontido, vamos recriar os \n# parâmetros essenciais aqui.\n# ============================================================\n\n# Parâmetros do estudo original\nestudo <- list(\n  populacao = 600000,\n  prop_mfc = 0.336,\n  prop_gen = 0.664\n)\n\n# Parâmetros do município simulado\nmunicipio <- list(\n  nome = \"Esperança\",\n  populacao = 500000,\n  n_medicos = 100,\n  prop_mfc_inicial = 0\n)\n\n# Parâmetros econômicos\neconomico <- list(\n  taxa_desconto = 0.05,\n  horizonte_anos = 10\n)\n\n# Custos de referência\ncusto_consulta_base <- 50.00\nfator_aih_base <- 1.5\n\ncat(\"Parâmetros carregados com sucesso!\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParâmetros carregados com sucesso!\n```\n\n\n:::\n:::\n\n\n---\n\n# Parte 1: Funções para Cálculo de Eventos\n\n## Conceito: Como a Cobertura MFC Afeta o Número de Eventos?\n\nImagine que você tem uma população de 100.000 pessoas e sabe que:\n\n- Generalistas solicitam **1.000 hemogramas por ano** para essa população\n- MFC solicitam **530 hemogramas por ano** (RR = 0,53, ou seja, 53% do que generalistas solicitam)\n\nSe **toda** a população for atendida por generalistas (0% MFC), teremos 1.000 hemogramas.\nSe **toda** a população for atendida por MFC (100% MFC), teremos 530 hemogramas.\nE se **metade** for atendida por cada tipo? Teremos uma média ponderada: 765 hemogramas.\n\n**A fórmula geral é:**\n\n$$\n\\text{Eventos} = \\text{Taxa}_{baseline} \\times \\left[ p_{MFC} \\times RR + (1 - p_{MFC}) \\right]\n$$\n\nOnde:\n\n- $\\text{Taxa}_{baseline}$ = eventos esperados se 100% fossem generalistas (calculado no Cap. 1)\n- $p_{MFC}$ = proporção de MFC (entre 0 e 1)\n- $RR$ = risco relativo do MFC comparado ao generalista\n\n**Por que isso funciona?**\n\nO termo entre colchetes $[p_{MFC} \\times RR + (1 - p_{MFC})]$ é um **fator de ajuste**:\n\n- Quando $p_{MFC} = 0$ (nenhum MFC): fator = 1,0 → eventos = baseline\n- Quando $p_{MFC} = 1$ (todos MFC): fator = RR → eventos = baseline × RR\n- Quando $p_{MFC}$ está entre 0 e 1: fator é uma média ponderada\n\n## Função: calcular_eventos_por_cobertura()\n\nEsta função calcula quantos eventos esperamos para qualquer nível de cobertura MFC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_eventos_por_cobertura <- function(eventos_baseline, rr, prop_mfc) {\n  #' Calcula o número esperado de eventos para um dado nível de cobertura MFC\n  #'\n  #' @param eventos_baseline Número de eventos no cenário 0% MFC (todos generalistas)\n  #' @param rr Risco Relativo - razão entre taxa MFC e taxa generalista\n  #' @param prop_mfc Proporção de cobertura MFC (valor entre 0 e 1)\n  #'\n  #' @return Número esperado de eventos\n  #'\n  #' @details\n  #' A função aplica a fórmula:\n  #' Eventos = baseline × (prop_mfc × RR + prop_gen)\n  #'\n  #' Onde prop_gen = 1 - prop_mfc\n  \n  # Validação: proporção deve estar entre 0 e 1\n  if (prop_mfc < 0 | prop_mfc > 1) {\n    stop(\"Erro: prop_mfc deve estar entre 0 e 1\")\n  }\n  \n  # Calcular proporção de generalistas\n  prop_gen <- 1 - prop_mfc\n  \n  # Calcular fator de ajuste\n  # Este fator representa \"quanto\" do baseline teremos\n  fator_ajuste <- (prop_mfc * rr) + prop_gen\n  \n  # Calcular eventos esperados\n  eventos <- eventos_baseline * fator_ajuste\n  \n  return(eventos)\n}\n```\n:::\n\n\n## Exemplo Prático: Hemograma\n\nVamos aplicar a função ao hemograma para entender como ela funciona:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dados do hemograma (do Capítulo 1)\nhemograma_baseline <- 57219  # eventos/ano no cenário 0% MFC para 500k habitantes\nhemograma_rr <- 0.53         # MFC solicita 53% do que generalista solicita\n\n# Calcular eventos para diferentes níveis de cobertura\ncoberturas <- c(0, 0.25, 0.50, 0.75, 1.00)\n\ncat(\"EXEMPLO: HEMOGRAMA\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEXEMPLO: HEMOGRAMA\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"==================\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n==================\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Baseline (0% MFC):\", formatar_numero(hemograma_baseline), \"exames/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBaseline (0% MFC): 57.219 exames/ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"RR:\", hemograma_rr, \"(MFC solicita\", hemograma_rr * 100, \"% do que generalista)\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRR: 0,53 (MFC solicita 53 % do que generalista)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Eventos esperados por nível de cobertura MFC:\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEventos esperados por nível de cobertura MFC:\n```\n\n\n:::\n\n```{.r .cell-code}\nresultados_hemograma <- data.frame(\n  cobertura_mfc = coberturas,\n  cobertura_pct = paste0(coberturas * 100, \"%\"),\n  eventos = sapply(coberturas, function(p) {\n    calcular_eventos_por_cobertura(hemograma_baseline, hemograma_rr, p)\n  })\n)\n\n# Adicionar colunas explicativas\nresultados_hemograma$reducao_absoluta <- hemograma_baseline - resultados_hemograma$eventos\nresultados_hemograma$reducao_pct <- round(\n  (1 - resultados_hemograma$eventos / hemograma_baseline) * 100, \n  1\n)\n\nknitr::kable(\n  resultados_hemograma[, c(\"cobertura_pct\", \"eventos\", \"reducao_absoluta\", \"reducao_pct\")],\n  col.names = c(\n    \"Cobertura MFC\", \n    \"Hemogramas/ano\", \n    \"Redução (absoluta)\",\n    \"Redução (%)\"\n  ),\n  digits = 0,\n  caption = \"Impacto da cobertura MFC sobre solicitação de hemograma\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Impacto da cobertura MFC sobre solicitação de hemograma\n\n|Cobertura MFC | Hemogramas/ano| Redução (absoluta)| Redução (%)|\n|:-------------|--------------:|------------------:|-----------:|\n|0%            |          57219|                  0|           0|\n|25%           |          50496|               6723|          12|\n|50%           |          43773|              13446|          24|\n|75%           |          37049|              20170|          35|\n|100%          |          30326|              26893|          47|\n\n\n:::\n:::\n\n\n**Interpretação:**\n\n- Com **0% MFC** (todos generalistas): ~57.000 hemogramas/ano\n- Com **50% MFC**: ~44.000 hemogramas/ano (redução de 23,5%)\n- Com **100% MFC**: ~30.000 hemogramas/ano (redução de 47%)\n\nA redução máxima possível (47%) corresponde exatamente a $1 - RR = 1 - 0,53 = 0,47$.\n\n---\n\n## Conceito: O que são \"Eventos Evitados\"?\n\n**Eventos evitados** são a diferença entre o que teríamos sem intervenção e o que temos com intervenção.\n\n$$\n\\text{Eventos evitados} = \\text{Eventos}_{antes} - \\text{Eventos}_{depois}\n$$\n\nNo nosso contexto:\n\n- **Antes** = cenário inicial (ex: 0% MFC)\n- **Depois** = cenário com programa implantado (ex: 60% MFC)\n\nSe antes tínhamos 1.000 internações e depois temos 700, evitamos 300 internações.\n\n**Por que isso é importante?**\n\nEventos evitados são a base para calcular o **benefício econômico**. Cada internação evitada representa uma economia de dinheiro para o sistema de saúde.\n\n## Função: calcular_eventos_evitados()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_eventos_evitados <- function(eventos_baseline, rr, prop_mfc_inicial, prop_mfc_final) {\n  #' Calcula quantos eventos são evitados ao mudar de um nível de cobertura para outro\n  #'\n  #' @param eventos_baseline Eventos no cenário 0% MFC\n  #' @param rr Risco Relativo\n  #' @param prop_mfc_inicial Cobertura MFC no cenário inicial\n  #' @param prop_mfc_final Cobertura MFC no cenário final\n  #'\n  #' @return Lista com eventos inicial, final, evitados e percentual de redução\n  #'\n  #' @details\n  #' Eventos evitados = Eventos(inicial) - Eventos(final)\n  #' Se o resultado for positivo, houve redução de eventos.\n  #' Se for negativo, houve aumento de eventos (pode acontecer se RR > 1).\n  \n  # Calcular eventos em cada cenário\n  eventos_inicial <- calcular_eventos_por_cobertura(eventos_baseline, rr, prop_mfc_inicial)\n  eventos_final <- calcular_eventos_por_cobertura(eventos_baseline, rr, prop_mfc_final)\n  \n  # Calcular eventos evitados\n  eventos_evitados <- eventos_inicial - eventos_final\n  \n  # Calcular redução percentual\n  # (eventos evitados / eventos inicial) × 100\n  if (eventos_inicial > 0) {\n    reducao_pct <- (eventos_evitados / eventos_inicial) * 100\n  } else {\n    reducao_pct <- 0\n  }\n  \n  # Retornar resultados em uma lista organizada\n  return(list(\n    eventos_inicial = eventos_inicial,\n    eventos_final = eventos_final,\n    eventos_evitados = eventos_evitados,\n    reducao_pct = reducao_pct\n  ))\n}\n```\n:::\n\n\n## Exemplo Prático: Internações por Insuficiência Cardíaca\n\nA insuficiência cardíaca é uma das condições com maior impacto econômico devido ao alto custo de internação.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dados de internação por IC (do Capítulo 1)\n# Baseline calculado: ~258 internações/ano para 500k habitantes com 0% MFC\nic_baseline <- 258\nic_rr <- 0.52  # MFC tem 52% da taxa de internação (48% menos)\n\n# Cenário: expandir de 0% para 60% MFC\nresultado_ic <- calcular_eventos_evitados(\n  eventos_baseline = ic_baseline,\n  rr = ic_rr,\n  prop_mfc_inicial = 0,\n  prop_mfc_final = 0.60\n)\n\ncat(\"EXEMPLO: INTERNAÇÕES POR INSUFICIÊNCIA CARDÍACA\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEXEMPLO: INTERNAÇÕES POR INSUFICIÊNCIA CARDÍACA\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"================================================\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n================================================\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Dados de entrada:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDados de entrada:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Baseline (0% MFC):\", formatar_numero(ic_baseline), \"internações/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Baseline (0% MFC): 258 internações/ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - RR:\", ic_rr, \"(MFC tem\", ic_rr * 100, \"% da taxa de internação)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - RR: 0,52 (MFC tem 52 % da taxa de internação)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Cenário: expandir de 0% para 60% MFC\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Cenário: expandir de 0% para 60% MFC\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Resultados:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nResultados:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Internações com 0% MFC:\", formatar_numero(resultado_ic$eventos_inicial), \"/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Internações com 0% MFC: 258 /ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Internações com 60% MFC:\", formatar_numero(resultado_ic$eventos_final), \"/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Internações com 60% MFC: 184 /ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Internações EVITADAS:\", formatar_numero(resultado_ic$eventos_evitados), \"/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Internações EVITADAS: 74 /ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Redução:\", round(resultado_ic$reducao_pct, 1), \"%\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Redução: 29 %\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Interpretação:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nInterpretação:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  Ao expandir a cobertura MFC de 0% para 60%, evitaríamos\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Ao expandir a cobertura MFC de 0% para 60%, evitaríamos\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  aproximadamente\", formatar_numero(resultado_ic$eventos_evitados), \n    \"internações por insuficiência cardíaca por ano.\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  aproximadamente 74 internações por insuficiência cardíaca por ano.\n```\n\n\n:::\n:::\n\n\n---\n\n## Conceito: Transformando Eventos Evitados em Economia\n\nCada evento evitado representa uma **economia financeira** para o sistema de saúde. Para calcular essa economia, multiplicamos:\n\n$$\n\\text{Economia} = \\text{Eventos evitados} \\times \\text{Custo unitário} \\times \\text{Fator de correção}\n$$\n\n**O que é o \"Fator de correção\"?**\n\nOs valores da tabela SUS (SIGTAP para procedimentos ambulatoriais, AIH para internações) representam apenas o **repasse federal** e estão muito defasados. O custo real é maior.\n\nPor exemplo:\n\n- Uma internação por insuficiência cardíaca paga AIH média de R$ 2.553\n- Mas o custo real pode ser 1,5x a 2x maior (R$ 3.800 a R$ 5.100)\n\nO fator de correção ajusta os valores tabelados para aproximar do custo real.\n\n## Função: calcular_economia()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_economia <- function(eventos_evitados, custo_unitario, fator_correcao = 1.0) {\n  #' Calcula a economia financeira a partir de eventos evitados\n  #'\n  #' @param eventos_evitados Número de eventos evitados\n  #' @param custo_unitario Custo por evento (R$) - valor tabelado\n  #' @param fator_correcao Multiplicador para aproximar do custo real\n  #'\n  #' @return Economia em R$\n  #'\n  #' @details\n  #' O fator de correção é usado porque os valores SIGTAP/AIH\n  #' subestimam o custo real. Valores típicos:\n  #' - 1.0: usar valor tabelado (subestimado)\n  #' - 1.5: correção moderada\n  #' - 2.0: correção alta (hospitais universitários)\n  \n  economia <- eventos_evitados * custo_unitario * fator_correcao\n  \n  return(economia)\n}\n```\n:::\n\n\n## Exemplo: Economia com Redução de Internações por IC\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Custo AIH médio para insuficiência cardíaca\ncusto_aih_ic <- 2553.91\n\n# Calcular economia com diferentes fatores de correção\neconomia_aih_pura <- calcular_economia(resultado_ic$eventos_evitados, custo_aih_ic, 1.0)\neconomia_moderada <- calcular_economia(resultado_ic$eventos_evitados, custo_aih_ic, 1.5)\neconomia_alta <- calcular_economia(resultado_ic$eventos_evitados, custo_aih_ic, 2.0)\n\ncat(\"ECONOMIA COM REDUÇÃO DE INTERNAÇÕES POR IC\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nECONOMIA COM REDUÇÃO DE INTERNAÇÕES POR IC\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"==========================================\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n==========================================\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Internações evitadas:\", formatar_numero(resultado_ic$eventos_evitados), \"/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nInternações evitadas: 74 /ano\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Custo AIH médio: R$\", formatar_numero(custo_aih_ic, 2), \"\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCusto AIH médio: R$ 2.553,91 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Economia anual por cenário de custo:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEconomia anual por cenário de custo:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - AIH pura (fator 1,0):    R$\", formatar_numero(economia_aih_pura, 2), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - AIH pura (fator 1,0):    R$ 189.765,73 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Moderado (fator 1,5):    R$\", formatar_numero(economia_moderada, 2), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Moderado (fator 1,5):    R$ 284.648,59 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"  - Alto (fator 2,0):        R$\", formatar_numero(economia_alta, 2), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  - Alto (fator 2,0):        R$ 379.531,46 \n```\n\n\n:::\n:::\n\n\n---\n\n# Parte 2: Função para Simular Expansão do Programa\n\n## Conceito: Como o Programa de Residência Expande a Cobertura MFC?\n\nO programa de residência não aumenta a cobertura MFC instantaneamente. É um processo **gradual** que segue esta lógica:\n\n**Ano 0 (antes do programa):**\n\n- Nenhum MFC no município (0% de cobertura)\n\n**Ano 1 (início do programa):**\n\n- Contratamos preceptores (MFC externos) para supervisionar\n- Abrimos a primeira turma de residentes (R1)\n- Cobertura aumenta apenas pelos preceptores\n\n**Ano 2:**\n\n- R1 se tornam R2 (segundo ano)\n- Nova turma de R1 entra\n- Ainda não há formados\n\n**Ano 3 em diante:**\n\n- R2 se formam\n- Uma **proporção** dos formados fica no município (taxa de retenção)\n- Cobertura aumenta progressivamente\n\n**O que é \"Taxa de Retenção\"?**\n\nNem todos os médicos formados pelo programa ficam trabalhando no município. Alguns vão para outras cidades, outros vão para o setor privado, etc.\n\nA **taxa de retenção** é a proporção dos formados que permanece na APS do município:\n\n- 40% (pessimista): de cada 10 formados, 4 ficam\n- 60% (moderado): de cada 10 formados, 6 ficam\n- 80% (otimista): de cada 10 formados, 8 ficam\n\n## Função: simular_expansao_programa()\n\nEsta é uma das funções mais importantes do modelo. Ela simula ano a ano como o programa evolui.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimular_expansao_programa <- function(\n    n_medicos_total,\n    prop_mfc_inicial = 0,\n    vagas_ano,\n    duracao_residencia = 2,\n    taxa_retencao,\n    horizonte_anos,\n    n_preceptores_inicial\n) {\n  #' Simula a expansão do programa de residência ao longo dos anos\n  #'\n  #' @param n_medicos_total Total de médicos na APS do município\n  #' @param prop_mfc_inicial Proporção inicial de MFC (geralmente 0)\n  #' @param vagas_ano Número de vagas abertas por ano\n  #' @param duracao_residencia Duração da residência em anos (padrão: 2)\n  #' @param taxa_retencao Proporção dos formados que ficam no município\n  #' @param horizonte_anos Número de anos a simular\n  #' @param n_preceptores_inicial MFC contratados no ano 1 para preceptoria\n  #'\n  #' @return Data frame com a evolução ano a ano\n  #'\n  #' @details\n  #' A simulação considera:\n  #' - Ano 1: entram preceptores + primeira turma R1\n  #' - Ano 2: R1 viram R2, nova turma R1\n  #' - Ano 3+: R2 formam (com retenção), R1 viram R2, nova turma R1\n  \n  # Criar vetor de anos (0 = antes do programa)\n  anos <- 0:horizonte_anos\n  n_anos <- length(anos)\n  \n  # Inicializar vetores para armazenar resultados\n  n_mfc <- numeric(n_anos)           # Total de MFC no município\n  n_residentes_r1 <- numeric(n_anos) # Residentes no 1º ano\n  n_residentes_r2 <- numeric(n_anos) # Residentes no 2º ano\n  n_formados_ano <- numeric(n_anos)  # Formados naquele ano\n  n_preceptores <- numeric(n_anos)   # Preceptores contratados\n  \n  # Ano 0: situação inicial (antes do programa)\n  n_mfc[1] <- round(n_medicos_total * prop_mfc_inicial)\n  n_residentes_r1[1] <- 0\n  n_residentes_r2[1] <- 0\n  n_formados_ano[1] <- 0\n  n_preceptores[1] <- 0\n  \n  # Simular cada ano\n  for (i in 2:n_anos) {\n    ano_atual <- anos[i]\n    \n    if (ano_atual == 1) {\n      # ANO 1: Início do programa\n      # - Contratamos preceptores externos\n      # - Abrimos primeira turma R1\n      # - Ninguém forma ainda\n      n_preceptores[i] <- n_preceptores_inicial\n      n_residentes_r1[i] <- vagas_ano\n      n_residentes_r2[i] <- 0\n      n_formados_ano[i] <- 0\n      n_mfc[i] <- n_mfc[i-1] + n_preceptores_inicial\n      \n    } else if (ano_atual == 2) {\n      # ANO 2: Programa em andamento\n      # - R1 do ano passado viram R2\n      # - Nova turma R1 entra\n      # - Ainda ninguém formou\n      n_preceptores[i] <- n_preceptores[i-1]\n      n_residentes_r2[i] <- n_residentes_r1[i-1]  # R1 viram R2\n      n_residentes_r1[i] <- vagas_ano             # Nova turma\n      n_formados_ano[i] <- 0\n      n_mfc[i] <- n_mfc[i-1]  # Sem novos MFC\n      \n    } else {\n      # ANO 3 em diante: Ciclo completo\n      # - R2 do ano passado se formam\n      # - Apenas uma proporção (taxa_retencao) fica no município\n      # - R1 viram R2\n      # - Nova turma R1\n      n_formados_ano[i] <- round(n_residentes_r2[i-1] * taxa_retencao)\n      n_residentes_r2[i] <- n_residentes_r1[i-1]\n      n_residentes_r1[i] <- vagas_ano\n      n_preceptores[i] <- n_preceptores[i-1]\n      n_mfc[i] <- n_mfc[i-1] + n_formados_ano[i]\n    }\n  }\n  \n  # Calcular proporção de MFC (limitada a 100%)\n  prop_mfc <- n_mfc / n_medicos_total\n  prop_mfc <- pmin(prop_mfc, 1)  # Não pode passar de 100%\n  \n  # Montar data frame de resultados\n  resultado <- data.frame(\n    ano = anos,\n    n_mfc = n_mfc,\n    n_residentes_r1 = n_residentes_r1,\n    n_residentes_r2 = n_residentes_r2,\n    n_residentes_total = n_residentes_r1 + n_residentes_r2,\n    n_formados_ano = n_formados_ano,\n    n_formados_acumulado = cumsum(n_formados_ano),\n    n_preceptores = n_preceptores,\n    prop_mfc = prop_mfc,\n    prop_mfc_pct = paste0(round(prop_mfc * 100, 1), \"%\")\n  )\n  \n  return(resultado)\n}\n```\n:::\n\n\n## Exemplo: Simulação com 15 Vagas/Ano e 60% de Retenção\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Parâmetros do programa (definidos aqui para o exemplo)\nprograma <- list(\n  vagas_por_ano = 15,\n  n_preceptores_inicial = 4,\n  taxa_retencao_moderada = 0.60\n)\n\n# Simular expansão do programa\nexpansao <- simular_expansao_programa(\n  n_medicos_total = municipio$n_medicos,       # 100 médicos\n  prop_mfc_inicial = 0,                         # Começa com 0% MFC\n  vagas_ano = programa$vagas_por_ano,           # 15 vagas/ano\n  taxa_retencao = programa$taxa_retencao_moderada,  # 60% ficam\n  horizonte_anos = economico$horizonte_anos,    # 10 anos\n  n_preceptores_inicial = programa$n_preceptores_inicial  # 4 preceptores\n)\n\n# Exibir tabela\nknitr::kable(\n  expansao[, c(\"ano\", \"n_mfc\", \"n_residentes_r1\", \"n_residentes_r2\", \n               \"n_formados_ano\", \"n_formados_acumulado\", \"prop_mfc_pct\")],\n  col.names = c(\n    \"Ano\", \n    \"MFC Total\", \n    \"Residentes R1\", \n    \"Residentes R2\", \n    \"Formados/ano\",\n    \"Formados Acum.\",\n    \"Cobertura MFC\"\n  ),\n  caption = \"Simulação da expansão do programa (15 vagas/ano, 60% retenção)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Simulação da expansão do programa (15 vagas/ano, 60% retenção)\n\n| Ano| MFC Total| Residentes R1| Residentes R2| Formados/ano| Formados Acum.|Cobertura MFC |\n|---:|---------:|-------------:|-------------:|------------:|--------------:|:-------------|\n|   0|         0|             0|             0|            0|              0|0%            |\n|   1|         4|            15|             0|            0|              0|4%            |\n|   2|         4|            15|            15|            0|              0|4%            |\n|   3|        13|            15|            15|            9|              9|13%           |\n|   4|        22|            15|            15|            9|             18|22%           |\n|   5|        31|            15|            15|            9|             27|31%           |\n|   6|        40|            15|            15|            9|             36|40%           |\n|   7|        49|            15|            15|            9|             45|49%           |\n|   8|        58|            15|            15|            9|             54|58%           |\n|   9|        67|            15|            15|            9|             63|67%           |\n|  10|        76|            15|            15|            9|             72|76%           |\n\n\n:::\n:::\n\n\n**Interpretação da tabela:**\n\n- **Ano 0**: Situação inicial - nenhum MFC no município\n- **Ano 1**: Entram 4 preceptores + 15 residentes R1 = 4 MFC (4%)\n- **Ano 2**: R1 viram R2, nova turma R1 = ainda 4 MFC\n- **Ano 3**: Primeira turma se forma! 15 × 60% = 9 novos MFC → total 13 MFC (13%)\n- **Ano 10**: Acumulado de ~76 MFC no município (76%)\n\n**Observação importante:** Com 15 vagas/ano e 60% de retenção, atingimos ~76% de cobertura em 10 anos. Para atingir 100%, precisaríamos de maior retenção (80%) ou mais tempo.\n\n---\n\n# Parte 3: Funções para Cálculo de Custos do Programa\n\n## Conceito: Quais são os Custos do Programa de Residência?\n\nO programa de residência tem vários componentes de custo. Vamos organizá-los em **cenários** para permitir análises mais flexíveis.\n\n### 3.1. Custos com Bolsas dos Residentes\n\nAs bolsas de residência médica podem ter diferentes composições, dependendo das fontes de financiamento disponíveis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Definir cenários de bolsa\ncenarios_bolsa <- data.frame(\n  cenario = c(\n    \"Mínimo (apenas MEC)\", \n    \"Intermediário (MEC + MS)\", \n    \"Completo (MEC + MS + Municipal)\"\n  ),\n  bolsa_mec = c(4106.90, 4106.90, 4106.90),\n  complemento_ms = c(0, 4000.00, 4000.00),\n  complemento_municipal = c(0, 0, 2000.00),\n  stringsAsFactors = FALSE\n)\n\ncenarios_bolsa$total_mensal <- cenarios_bolsa$bolsa_mec + \n                                cenarios_bolsa$complemento_ms + \n                                cenarios_bolsa$complemento_municipal\n\ncenarios_bolsa$total_anual <- cenarios_bolsa$total_mensal * 12\n\nknitr::kable(\n  cenarios_bolsa,\n  col.names = c(\"Cenário\", \"Bolsa MEC\", \"Complemento MS\", \n                \"Complemento Municipal\", \"Total Mensal\", \"Total Anual\"),\n  caption = \"Cenários de composição da bolsa de residência (R$)\",\n  digits = 2\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Cenários de composição da bolsa de residência (R$)\n\n|Cenário                         | Bolsa MEC| Complemento MS| Complemento Municipal| Total Mensal| Total Anual|\n|:-------------------------------|---------:|--------------:|---------------------:|------------:|-----------:|\n|Mínimo (apenas MEC)             |      4107|              0|                     0|         4107|       49283|\n|Intermediário (MEC + MS)        |      4107|           4000|                     0|         8107|       97283|\n|Completo (MEC + MS + Municipal) |      4107|           4000|                  2000|        10107|      121283|\n\n\n:::\n:::\n\n\n**Explicação dos componentes:**\n\n- **Bolsa MEC (Ministério da Educação)**: Valor pago pelo governo federal a todos os residentes médicos do país. Em 2024, o valor é de R$ 4.106,90 por mês. Este é o valor **mínimo garantido** por lei.\n\n- **Complemento MS (Ministério da Saúde)**: Adicional pago pelo Ministério da Saúde especificamente para residências em áreas consideradas prioritárias para o SUS, como Medicina de Família e Comunidade, Psiquiatria, entre outras. O valor atual é de R$ 4.000,00 por mês. **Nem todos os programas recebem este complemento** - é necessário que o programa esteja credenciado junto ao MS.\n\n- **Complemento Municipal**: Alguns municípios, especialmente aqueles com dificuldade de atrair residentes, oferecem um complemento adicional com recursos próprios. Valores variam de R$ 1.000 a R$ 3.000 por mês. Este é um custo **adicional para o município**.\n\n### 3.2. Custo de Preceptoria\n\n**O que é preceptoria?**\n\nPreceptores são médicos MFC experientes que supervisionam e ensinam os residentes durante suas atividades práticas. A relação preceptor-residente é fundamental para a qualidade da formação.\n\n**Como funciona o pagamento?**\n\nOs preceptores geralmente já são médicos contratados pelo município para atender na APS. A preceptoria representa uma **atividade adicional** às suas funções assistenciais, e por isso recebem um **adicional de preceptoria**.\n\n- **Valor típico**: R$ 4.000,00/mês por preceptor\n- **Proporção recomendada**: 1 preceptor para cada 4-5 residentes\n\n### 3.3. Custos Operacionais\n\nSão os custos administrativos e de infraestrutura necessários para o funcionamento do programa:\n\n- Coordenação pedagógica (pode ser um MFC com carga horária dedicada)\n- Materiais didáticos e bibliográficos\n- Espaço físico para atividades teóricas (sala de aula, biblioteca)\n- Eventos científicos (jornadas, congressos, capacitações)\n- Despesas administrativas (secretaria, sistemas de gestão)\n\n**Estimativa**: R$ 50.000,00 por ano para um programa de 15-20 vagas.\n\n### 3.4. Incentivo Federal (RECEITA, não custo)\n\nO Ministério da Saúde paga um **incentivo financeiro** para equipes de Saúde da Família que recebem residentes. Este valor funciona como uma **receita** que reduz o custo líquido do programa para o município.\n\n- **Valor**: R$ 4.500,00 por mês por equipe que recebe residente\n- **Base legal**: Portaria GM/MS nº 3.510/2019\n- **Lógica**: Compensa a equipe pelo tempo dedicado ao ensino e pela menor produtividade esperada durante o treinamento\n\n### 3.5. Adicional por Especialidade MFC (Incentivo à Retenção)\n\n**O que é?**\n\nÉ um **adicional salarial** pago aos médicos que possuem título de especialista em MFC, fazendo com que ganhem mais do que médicos generalistas sem especialização.\n\n**Para que serve?**\n\nO principal objetivo é **aumentar a retenção** dos MFC formados no município. Se um MFC ganha o mesmo que um generalista, há pouco incentivo financeiro para que ele permaneça na APS do município após se formar. O adicional por especialidade cria uma diferenciação salarial que:\n\n1. **Atrai MFC de outros lugares**: Médicos de família de outros municípios podem querer trabalhar onde há valorização da especialidade\n2. **Retém os formados**: Os residentes formados pelo programa têm incentivo financeiro para permanecer\n3. **Valoriza a formação**: Sinaliza institucionalmente que o município reconhece e valoriza a diferença entre um MFC e um generalista\n\n**Como calcular?**\n\nO adicional é um percentual sobre o salário base do médico:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Salário base de médico na APS (estimativa para município de médio porte)\nsalario_base_medico <- 15000\n\n# Definir cenários de adicional por especialidade\ncenarios_adicional <- data.frame(\n  cenario = c(\n    \"Sem adicional\", \n    \"Adicional de 10%\", \n    \"Adicional de 20%\"\n  ),\n  percentual = c(0, 0.10, 0.20),\n  stringsAsFactors = FALSE\n)\n\ncenarios_adicional$valor_adicional_mensal <- salario_base_medico * cenarios_adicional$percentual\ncenarios_adicional$valor_adicional_anual <- cenarios_adicional$valor_adicional_mensal * 12\ncenarios_adicional$salario_total_mensal <- salario_base_medico + cenarios_adicional$valor_adicional_mensal\n\nknitr::kable(\n  cenarios_adicional,\n  col.names = c(\"Cenário\", \"Percentual\", \"Adicional Mensal (R$)\", \n                \"Adicional Anual (R$)\", \"Salário Total MFC (R$)\"),\n  caption = \"Cenários de adicional por especialidade MFC (base: salário de R$ 15.000/mês)\",\n  digits = 2\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Cenários de adicional por especialidade MFC (base: salário de R$ 15.000/mês)\n\n|Cenário          | Percentual| Adicional Mensal (R$)| Adicional Anual (R$)| Salário Total MFC (R$)|\n|:----------------|----------:|---------------------:|--------------------:|----------------------:|\n|Sem adicional    |        0,0|                     0|                    0|                  15000|\n|Adicional de 10% |        0,1|                  1500|                18000|                  16500|\n|Adicional de 20% |        0,2|                  3000|                36000|                  18000|\n\n\n:::\n:::\n\n\n**Importante:** O adicional por especialidade é um **custo contínuo e crescente**. Ele incide sobre **todos** os MFC que trabalham no município, não apenas sobre os formados pelo programa. Conforme a cobertura MFC aumenta, este custo também aumenta.\n\n**Exemplo:**\n\n- Ano 3: 13 MFC no município × R$ 1.500/mês (10%) × 12 meses = R$ 234.000/ano\n- Ano 10: 76 MFC no município × R$ 1.500/mês (10%) × 12 meses = R$ 1.368.000/ano\n\nEste é um custo significativo que precisa ser considerado na análise.\n\n## Função: calcular_custos_programa()\n\nEsta função calcula os custos anuais considerando todos os componentes descritos acima. Ela permite configurar diferentes cenários de bolsa e adicional por especialidade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_custos_programa <- function(\n    expansao_df,\n    bolsa_mensal,\n    custo_preceptor_mensal,\n    incentivo_equipe_mensal,\n    custo_operacional_anual,\n    adicional_especialidade_pct = 0,\n    salario_base_medico = 15000\n) {\n  #' Calcula os custos anuais do programa de residência\n  #'\n  #' @param expansao_df Data frame gerado por simular_expansao_programa()\n  #' @param bolsa_mensal Bolsa total do residente (R$/mês)\n  #' @param custo_preceptor_mensal Adicional de preceptoria (R$/mês)\n  #' @param incentivo_equipe_mensal Incentivo federal por equipe com residente\n  #' @param custo_operacional_anual Custos operacionais fixos (R$/ano)\n  #' @param adicional_especialidade_pct Percentual de adicional para MFC (0.10 = 10%)\n  #' @param salario_base_medico Salário base do médico para cálculo do adicional\n  #'\n  #' @return Data frame com custos detalhados por ano\n  #'\n  #' @details\n  #' Custo líquido = Custo bruto - Receita do incentivo federal\n  #' O adicional por especialidade incide sobre todos os MFC no município.\n  \n  n_anos <- nrow(expansao_df)\n  \n  # 1. Bolsas dos residentes (R1 + R2)\n  custo_bolsas <- expansao_df$n_residentes_total * bolsa_mensal * 12\n  \n  # 2. Custo de preceptoria\n  custo_preceptoria <- expansao_df$n_preceptores * custo_preceptor_mensal * 12\n  \n  # 3. Custos operacionais (só a partir do ano 1)\n  custo_operacional <- ifelse(expansao_df$ano > 0, custo_operacional_anual, 0)\n  \n  # 4. Adicional por especialidade\n  # Incide sobre TODOS os MFC no município (preceptores + formados retidos)\n  adicional_mensal_por_mfc <- salario_base_medico * adicional_especialidade_pct\n  custo_adicional_especialidade <- expansao_df$n_mfc * adicional_mensal_por_mfc * 12\n  \n  # 5. Incentivo federal (receita, não custo)\n  # Cada residente está em uma equipe diferente\n  receita_incentivo <- expansao_df$n_residentes_total * incentivo_equipe_mensal * 12\n  \n  # Calcular totais\n  custo_bruto <- custo_bolsas + custo_preceptoria + custo_operacional + custo_adicional_especialidade\n  custo_liquido <- custo_bruto - receita_incentivo\n  custo_liquido <- pmax(custo_liquido, 0)  # Não pode ser negativo\n  \n  # Montar data frame de resultados\n  custos <- data.frame(\n    ano = expansao_df$ano,\n    n_mfc = expansao_df$n_mfc,\n    n_residentes = expansao_df$n_residentes_total,\n    custo_bolsas = custo_bolsas,\n    custo_preceptoria = custo_preceptoria,\n    custo_operacional = custo_operacional,\n    custo_adicional_esp = custo_adicional_especialidade,\n    custo_bruto = custo_bruto,\n    receita_incentivo = receita_incentivo,\n    custo_liquido = custo_liquido\n  )\n  \n  return(custos)\n}\n```\n:::\n\n\n## Comparação de Cenários de Custo\n\nVamos comparar quatro cenários para entender o impacto de cada componente:\n\n1. **Cenário Mínimo**: Apenas bolsa MEC, sem adicional por especialidade\n2. **Cenário Intermediário**: Bolsa MEC + MS, sem adicional por especialidade\n3. **Cenário com Adicional 10%**: Bolsa MEC + MS, com 10% de adicional por especialidade\n4. **Cenário com Adicional 20%**: Bolsa MEC + MS, com 20% de adicional por especialidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cenário 1: Mínimo (apenas bolsa MEC, sem adicional)\ncustos_minimo <- calcular_custos_programa(\n  expansao_df = expansao,\n  bolsa_mensal = 4106.90,\n  custo_preceptor_mensal = 4000,\n  incentivo_equipe_mensal = 4500,\n  custo_operacional_anual = 50000,\n  adicional_especialidade_pct = 0\n)\n\n# Cenário 2: Intermediário (MEC + MS, sem adicional)\ncustos_intermediario <- calcular_custos_programa(\n  expansao_df = expansao,\n  bolsa_mensal = 8106.90,\n  custo_preceptor_mensal = 4000,\n  incentivo_equipe_mensal = 4500,\n  custo_operacional_anual = 50000,\n  adicional_especialidade_pct = 0\n)\n\n# Cenário 3: Com adicional 10%\ncustos_adicional_10 <- calcular_custos_programa(\n  expansao_df = expansao,\n  bolsa_mensal = 8106.90,\n  custo_preceptor_mensal = 4000,\n  incentivo_equipe_mensal = 4500,\n  custo_operacional_anual = 50000,\n  adicional_especialidade_pct = 0.10,\n  salario_base_medico = 15000\n)\n\n# Cenário 4: Com adicional 20%\ncustos_adicional_20 <- calcular_custos_programa(\n  expansao_df = expansao,\n  bolsa_mensal = 8106.90,\n  custo_preceptor_mensal = 4000,\n  incentivo_equipe_mensal = 4500,\n  custo_operacional_anual = 50000,\n  adicional_especialidade_pct = 0.20,\n  salario_base_medico = 15000\n)\n\n# Comparar totais em 10 anos\ncomparacao_custos <- data.frame(\n  cenario = c(\n    \"1. Mínimo (MEC)\", \n    \"2. Intermediário (MEC+MS)\", \n    \"3. MEC+MS + Adicional 10%\",\n    \"4. MEC+MS + Adicional 20%\"\n  ),\n  custo_bruto = c(\n    sum(custos_minimo$custo_bruto),\n    sum(custos_intermediario$custo_bruto),\n    sum(custos_adicional_10$custo_bruto),\n    sum(custos_adicional_20$custo_bruto)\n  ),\n  receita_incentivo = c(\n    sum(custos_minimo$receita_incentivo),\n    sum(custos_intermediario$receita_incentivo),\n    sum(custos_adicional_10$receita_incentivo),\n    sum(custos_adicional_20$receita_incentivo)\n  ),\n  custo_liquido = c(\n    sum(custos_minimo$custo_liquido),\n    sum(custos_intermediario$custo_liquido),\n    sum(custos_adicional_10$custo_liquido),\n    sum(custos_adicional_20$custo_liquido)\n  )\n)\n\n# Formatar para exibição\ncomparacao_custos$custo_bruto_fmt <- paste0(\"R$ \", formatar_numero(comparacao_custos$custo_bruto))\ncomparacao_custos$receita_fmt <- paste0(\"R$ \", formatar_numero(comparacao_custos$receita_incentivo))\ncomparacao_custos$custo_liquido_fmt <- paste0(\"R$ \", formatar_numero(comparacao_custos$custo_liquido))\n\nknitr::kable(\n  comparacao_custos[, c(\"cenario\", \"custo_bruto_fmt\", \"receita_fmt\", \"custo_liquido_fmt\")],\n  col.names = c(\"Cenário\", \"Custo Bruto (10 anos)\", \n                \"Receita Incentivo\", \"Custo Líquido (10 anos)\"),\n  caption = \"Comparação de cenários de custo do programa\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Comparação de cenários de custo do programa\n\n|Cenário                   |Custo Bruto (10 anos) |Receita Incentivo |Custo Líquido (10 anos) |\n|:-------------------------|:---------------------|:-----------------|:-----------------------|\n|1. Mínimo (MEC)           |R$ 16.465.598         |R$ 15.390.000     |R$  1.075.598           |\n|2. Intermediário (MEC+MS) |R$ 30.145.598         |R$ 15.390.000     |R$ 14.755.598           |\n|3. MEC+MS + Adicional 10% |R$ 36.697.598         |R$ 15.390.000     |R$ 21.307.598           |\n|4. MEC+MS + Adicional 20% |R$ 43.249.598         |R$ 15.390.000     |R$ 27.859.598           |\n\n\n:::\n:::\n\n\n**Análise da comparação:**\n\n- O **incentivo federal** é igual em todos os cenários (depende apenas do número de residentes)\n- A diferença entre cenário 1 e 2 é o **complemento do MS** (R$ 4.000/mês por residente)\n- O **adicional por especialidade** tem impacto crescente ao longo do tempo, pois depende do número de MFC no município\n- Com adicional de 20%, o custo líquido em 10 anos é mais que o dobro do cenário mínimo\n\n## Detalhamento: Cenário Intermediário (base para análises)\n\nO cenário intermediário (bolsa MEC + MS, sem adicional por especialidade) será usado como **cenário base** nas análises seguintes, por representar uma situação realista para municípios com programa credenciado pelo MS.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Usar cenário intermediário como base\ncustos <- custos_intermediario\n\n# Exibir tabela detalhada (valores em milhares)\ncustos_display <- data.frame(\n  ano = custos$ano,\n  n_mfc = custos$n_mfc,\n  n_residentes = custos$n_residentes,\n  bolsas = round(custos$custo_bolsas / 1000, 1),\n  preceptoria = round(custos$custo_preceptoria / 1000, 1),\n  operacional = round(custos$custo_operacional / 1000, 1),\n  bruto = round(custos$custo_bruto / 1000, 1),\n  incentivo = round(custos$receita_incentivo / 1000, 1),\n  liquido = round(custos$custo_liquido / 1000, 1)\n)\n\nknitr::kable(\n  custos_display,\n  col.names = c(\"Ano\", \"MFC\", \"Resid.\", \"Bolsas\", \"Precept.\", \n                \"Operac.\", \"Bruto\", \"Incentivo\", \"Líquido\"),\n  caption = \"Custos anuais - Cenário Intermediário (valores em R$ mil)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Custos anuais - Cenário Intermediário (valores em R$ mil)\n\n| Ano| MFC| Resid.| Bolsas| Precept.| Operac.| Bruto| Incentivo| Líquido|\n|---:|---:|------:|------:|--------:|-------:|-----:|---------:|-------:|\n|   0|   0|      0|      0|        0|       0|     0|         0|       0|\n|   1|   4|     15|   1459|      192|      50|  1701|       810|     891|\n|   2|   4|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   3|  13|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   4|  22|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   5|  31|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   6|  40|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   7|  49|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   8|  58|     30|   2918|      192|      50|  3160|      1620|    1540|\n|   9|  67|     30|   2918|      192|      50|  3160|      1620|    1540|\n|  10|  76|     30|   2918|      192|      50|  3160|      1620|    1540|\n\n\n:::\n\n```{.r .cell-code}\n# Totais\ncat(\"\\nRESUMO DOS CUSTOS - CENÁRIO INTERMEDIÁRIO (10 anos):\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRESUMO DOS CUSTOS - CENÁRIO INTERMEDIÁRIO (10 anos):\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"====================================================\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n====================================================\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Custo com bolsas: R$\", formatar_numero(sum(custos$custo_bolsas)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCusto com bolsas: R$ 27.725.598 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Custo com preceptoria: R$\", formatar_numero(sum(custos$custo_preceptoria)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCusto com preceptoria: R$ 1.920.000 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Custos operacionais: R$\", formatar_numero(sum(custos$custo_operacional)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCustos operacionais: R$ 500.000 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"CUSTO BRUTO TOTAL: R$\", formatar_numero(sum(custos$custo_bruto)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCUSTO BRUTO TOTAL: R$ 30.145.598 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Receita incentivo federal: R$\", formatar_numero(sum(custos$receita_incentivo)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReceita incentivo federal: R$ 15.390.000 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"CUSTO LÍQUIDO TOTAL: R$\", formatar_numero(sum(custos$custo_liquido)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCUSTO LÍQUIDO TOTAL: R$ 14.755.598 \n```\n\n\n:::\n:::\n\n\n---\n\n# Parte 4: Funções Econômicas\n\n## Conceito: O que é Valor Presente?\n\nDinheiro tem **valor temporal**: R$ 100 hoje valem mais que R$ 100 daqui a um ano. Isso acontece por três razões principais:\n\n1. **Inflação**: O dinheiro perde poder de compra ao longo do tempo. R$ 100 hoje compram mais coisas do que R$ 100 daqui a 5 anos.\n\n2. **Custo de oportunidade**: Se você tem R$ 100 hoje, pode investir e receber juros. Daqui a um ano, terá mais do que R$ 100.\n\n3. **Incerteza**: Dinheiro prometido para o futuro é menos certo que dinheiro na mão. Muitas coisas podem acontecer até lá.\n\nO **Valor Presente (VP)** é uma técnica para converter valores futuros em valores equivalentes de hoje. A fórmula é:\n\n$$\nVP = \\frac{VF}{(1 + r)^n}\n$$\n\nOnde:\n\n- $VF$ = Valor Futuro (dinheiro no ano $n$)\n- $r$ = Taxa de desconto (ex: 5% = 0,05)\n- $n$ = Número de anos no futuro\n\n**Por que usar taxa de 5%?**\n\nO Ministério da Saúde brasileiro recomenda usar **5% ao ano** como taxa de desconto para avaliações econômicas em saúde. Este valor reflete aproximadamente a taxa real de juros de longo prazo no país.\n\n## Função: calcular_valor_presente()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_valor_presente <- function(valor_futuro, ano, taxa_desconto) {\n  #' Calcula o valor presente de um valor futuro\n  #'\n  #' @param valor_futuro Valor em reais no ano especificado\n  #' @param ano Ano do valor (0 = hoje, 1 = daqui 1 ano, etc.)\n  #' @param taxa_desconto Taxa de desconto anual (ex: 0.05 para 5%)\n  #'\n  #' @return Valor presente em reais\n  \n  valor_presente <- valor_futuro / ((1 + taxa_desconto) ^ ano)\n  \n  return(valor_presente)\n}\n```\n:::\n\n\n## Demonstração do Valor Presente\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Demonstrar como R$ 1.000 \"valem menos\" ao longo do tempo\ndemo_vp <- data.frame(\n  ano = 0:10,\n  valor_nominal = 1000\n)\n\ndemo_vp$valor_presente <- sapply(demo_vp$ano, function(a) {\n  calcular_valor_presente(1000, a, 0.05)\n})\n\ndemo_vp$perda_pct <- round((1 - demo_vp$valor_presente / 1000) * 100, 1)\n\nknitr::kable(\n  demo_vp,\n  col.names = c(\"Ano\", \"Valor Nominal (R$)\", \"Valor Presente (R$)\", \"\\\"Perda\\\" (%)\"),\n  digits = c(0, 0, 2, 1),\n  caption = \"Efeito do desconto temporal sobre R$ 1.000 (taxa 5% a.a.)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Efeito do desconto temporal sobre R$ 1.000 (taxa 5% a.a.)\n\n| Ano| Valor Nominal (R$)| Valor Presente (R$)| \"Perda\" (%)|\n|---:|------------------:|-------------------:|-----------:|\n|   0|               1000|                1000|         0,0|\n|   1|               1000|                 952|         4,8|\n|   2|               1000|                 907|         9,3|\n|   3|               1000|                 864|        13,6|\n|   4|               1000|                 823|        17,7|\n|   5|               1000|                 784|        21,6|\n|   6|               1000|                 746|        25,4|\n|   7|               1000|                 711|        28,9|\n|   8|               1000|                 677|        32,3|\n|   9|               1000|                 645|        35,5|\n|  10|               1000|                 614|        38,6|\n\n\n:::\n:::\n\n\n**Como interpretar:**\n\n- R$ 1.000 **hoje** (ano 0) valem R$ 1.000\n- R$ 1.000 **daqui a 5 anos** valem R$ 783,53 em valores de hoje\n- R$ 1.000 **daqui a 10 anos** valem R$ 613,91 em valores de hoje\n\n**Implicação para nossa análise:**\n\nOs custos do programa acontecem nos primeiros anos (mais \"caros\" em valor presente), enquanto os benefícios se acumulam ao longo do tempo (mais \"baratos\" em valor presente). O desconto penaliza projetos com retorno tardio.\n\n---\n\n## Conceito: O que é Valor Presente Líquido (VPL)?\n\nO **Valor Presente Líquido (VPL)** é o indicador mais importante para avaliar a viabilidade econômica de um projeto. Ele responde à pergunta: **\"Este projeto gera valor ou destrói valor?\"**\n\nO VPL é calculado somando todos os fluxos de caixa futuros (benefícios menos custos), convertidos para valor presente:\n\n$$\nVPL = \\sum_{t=0}^{T} \\frac{B_t - C_t}{(1 + r)^t}\n$$\n\nOnde:\n\n- $B_t$ = Benefício no ano $t$\n- $C_t$ = Custo no ano $t$\n- $r$ = Taxa de desconto\n- $T$ = Horizonte temporal\n\n**Como interpretar o VPL:**\n\n| VPL | Interpretação |\n|-----|---------------|\n| VPL > 0 | Os benefícios superam os custos (considerando o valor do dinheiro no tempo). **Projeto economicamente viável.** |\n| VPL = 0 | Os benefícios igualam os custos. Projeto \"empata\" - retorno igual ao custo de oportunidade. |\n| VPL < 0 | Os custos superam os benefícios. **Projeto economicamente inviável** do ponto de vista estritamente financeiro. |\n\n**Importante:** Um VPL negativo não significa automaticamente que o projeto não deva ser implementado. Existem benefícios não monetizáveis (qualidade de vida, equidade no acesso, formação de recursos humanos) que podem justificar o investimento mesmo com VPL negativo.\n\n## Função: calcular_vpl()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_vpl <- function(fluxos_caixa, taxa_desconto) {\n  #' Calcula o Valor Presente Líquido de uma série de fluxos de caixa\n  #'\n  #' @param fluxos_caixa Vetor com os saldos anuais (benefício - custo)\n  #' @param taxa_desconto Taxa de desconto anual\n  #'\n  #' @return VPL em R$\n  \n  # Identificar anos (começa em 0)\n  anos <- seq_along(fluxos_caixa) - 1\n  \n  # Calcular valor presente de cada fluxo\n  valores_presentes <- mapply(function(valor, ano) {\n    calcular_valor_presente(valor, ano, taxa_desconto)\n  }, fluxos_caixa, anos)\n  \n  # Somar todos os valores presentes\n  vpl <- sum(valores_presentes)\n  \n  return(vpl)\n}\n```\n:::\n\n\n---\n\n## Conceito: O que é ROI (Retorno sobre Investimento)?\n\nO **ROI (Return on Investment)** é uma medida percentual que indica quanto de retorno se obtém para cada real investido. É um indicador simples e intuitivo.\n\n$$\nROI = \\frac{Benefício_{total} - Custo_{total}}{Custo_{total}} \\times 100\\%\n$$\n\n**Como interpretar:**\n\n| ROI | Interpretação |\n|-----|---------------|\n| ROI = 50% | Para cada R$ 100 investidos, obteve-se R$ 150 de retorno (lucro de R$ 50) |\n| ROI = 0% | Para cada R$ 100 investidos, obteve-se R$ 100 de retorno (empate) |\n| ROI = -30% | Para cada R$ 100 investidos, obteve-se R$ 70 de retorno (prejuízo de R$ 30) |\n\n## Conceito: O que é RCB (Razão Custo-Benefício)?\n\nA **RCB (Razão Custo-Benefício)** indica quantos reais de benefício são gerados para cada real de custo:\n\n$$\nRCB = \\frac{Benefício_{total}}{Custo_{total}}\n$$\n\n**Como interpretar:**\n\n| RCB | Interpretação |\n|-----|---------------|\n| RCB > 1 | Benefícios superam custos. Projeto gera valor. |\n| RCB = 1 | Benefícios igualam custos. Empate. |\n| RCB < 1 | Custos superam benefícios. Projeto não gera valor financeiro. |\n\n**Exemplo:** RCB = 1,5 significa que para cada R$ 1 investido, obtém-se R$ 1,50 de benefício.\n\n## Funções: calcular_roi() e calcular_rcb()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_roi <- function(custo_total, beneficio_total) {\n  #' Calcula o Retorno sobre Investimento\n  #'\n  #' @param custo_total Soma de todos os custos\n  #' @param beneficio_total Soma de todos os benefícios\n  #'\n  #' @return ROI em percentual\n  \n  roi <- ((beneficio_total - custo_total) / custo_total) * 100\n  return(roi)\n}\n\ncalcular_rcb <- function(custo_total, beneficio_total) {\n  #' Calcula a Razão Custo-Benefício\n  #'\n  #' @param custo_total Soma de todos os custos\n  #' @param beneficio_total Soma de todos os benefícios\n  #'\n  #' @return RCB (adimensional)\n  \n  rcb <- beneficio_total / custo_total\n  return(rcb)\n}\n```\n:::\n\n\n---\n\n## Conceito: O que é Payback (Tempo de Retorno)?\n\nO **Payback** é o tempo necessário para \"recuperar\" o investimento inicial. É o momento em que os benefícios acumulados se igualam aos custos acumulados.\n\n**Existem dois tipos:**\n\n1. **Payback Simples**: Usa valores nominais (sem considerar o valor do dinheiro no tempo). É mais fácil de calcular e comunicar, mas menos preciso.\n\n2. **Payback Descontado**: Usa valores presentes. É tecnicamente mais correto, mas resulta em paybacks mais longos.\n\n**Como interpretar:**\n\n- **Payback = 5 anos**: O investimento se paga em 5 anos. A partir do ano 6, todo benefício é \"lucro\".\n- **Payback > horizonte**: O investimento não se paga no período analisado.\n\n## Função: calcular_payback()\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalcular_payback <- function(custos, beneficios, taxa_desconto = NULL) {\n  #' Calcula o período de payback (simples ou descontado)\n  #'\n  #' @param custos Vetor de custos anuais\n  #' @param beneficios Vetor de benefícios anuais\n  #' @param taxa_desconto Se NULL, calcula payback simples.\n  #'                      Se informado, calcula payback descontado.\n  #'\n  #' @return Ano em que o payback é atingido (ou NA se não atingido)\n  \n  n_anos <- length(custos)\n  anos <- seq_along(custos) - 1  # Começa em 0\n  \n  if (is.null(taxa_desconto)) {\n    # Payback simples: usar valores nominais\n    custo_acum <- cumsum(custos)\n    benef_acum <- cumsum(beneficios)\n  } else {\n    # Payback descontado: converter para valor presente\n    custo_vp <- sapply(seq_along(custos), function(i) {\n      calcular_valor_presente(custos[i], anos[i], taxa_desconto)\n    })\n    benef_vp <- sapply(seq_along(beneficios), function(i) {\n      calcular_valor_presente(beneficios[i], anos[i], taxa_desconto)\n    })\n    custo_acum <- cumsum(custo_vp)\n    benef_acum <- cumsum(benef_vp)\n  }\n  \n  # Encontrar primeiro ano onde benefício acumulado >= custo acumulado\n  saldo_acum <- benef_acum - custo_acum\n  payback_idx <- which(saldo_acum >= 0)[1]\n  \n  if (is.na(payback_idx)) {\n    return(NA)  # Payback não atingido no horizonte\n  } else {\n    return(anos[payback_idx])\n  }\n}\n```\n:::\n\n\n---\n\n# Resumo do Capítulo\n\n## Funções Criadas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfuncoes_criadas <- data.frame(\n  funcao = c(\n    \"calcular_eventos_por_cobertura()\",\n    \"calcular_eventos_evitados()\",\n    \"calcular_economia()\",\n    \"simular_expansao_programa()\",\n    \"calcular_custos_programa()\",\n    \"calcular_valor_presente()\",\n    \"calcular_vpl()\",\n    \"calcular_roi()\",\n    \"calcular_rcb()\",\n    \"calcular_payback()\"\n  ),\n  finalidade = c(\n    \"Eventos esperados para um nível de cobertura MFC\",\n    \"Diferença de eventos entre dois cenários\",\n    \"Converter eventos evitados em economia (R$)\",\n    \"Evolução do programa ao longo dos anos\",\n    \"Custos anuais (múltiplos cenários de bolsa e adicional)\",\n    \"Converter valor futuro em valor presente\",\n    \"Indicador de viabilidade econômica\",\n    \"Retorno percentual sobre investimento\",\n    \"Benefício por real investido\",\n    \"Tempo para recuperar o investimento\"\n  )\n)\n\nknitr::kable(\n  funcoes_criadas,\n  col.names = c(\"Função\", \"Finalidade\"),\n  caption = \"Resumo das funções desenvolvidas\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Resumo das funções desenvolvidas\n\n|Função                           |Finalidade                                              |\n|:--------------------------------|:-------------------------------------------------------|\n|calcular_eventos_por_cobertura() |Eventos esperados para um nível de cobertura MFC        |\n|calcular_eventos_evitados()      |Diferença de eventos entre dois cenários                |\n|calcular_economia()              |Converter eventos evitados em economia (R$)             |\n|simular_expansao_programa()      |Evolução do programa ao longo dos anos                  |\n|calcular_custos_programa()       |Custos anuais (múltiplos cenários de bolsa e adicional) |\n|calcular_valor_presente()        |Converter valor futuro em valor presente                |\n|calcular_vpl()                   |Indicador de viabilidade econômica                      |\n|calcular_roi()                   |Retorno percentual sobre investimento                   |\n|calcular_rcb()                   |Benefício por real investido                            |\n|calcular_payback()               |Tempo para recuperar o investimento                     |\n\n\n:::\n:::\n\n\n## Cenários de Custo Disponíveis\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"CENÁRIOS DE CUSTO CONFIGURÁVEIS\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCENÁRIOS DE CUSTO CONFIGURÁVEIS\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"================================\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n================================\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"1. COMPOSIÇÃO DA BOLSA:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. COMPOSIÇÃO DA BOLSA:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Mínimo: apenas bolsa MEC (R$ 4.106,90/mês)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Mínimo: apenas bolsa MEC (R$ 4.106,90/mês)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Intermediário: MEC + MS (R$ 8.106,90/mês) [CENÁRIO BASE]\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Intermediário: MEC + MS (R$ 8.106,90/mês) [CENÁRIO BASE]\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Completo: MEC + MS + Municipal (R$ 10.106,90/mês)\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Completo: MEC + MS + Municipal (R$ 10.106,90/mês)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"2. ADICIONAL POR ESPECIALIDADE MFC:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2. ADICIONAL POR ESPECIALIDADE MFC:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Sem adicional: MFC ganha igual ao generalista\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Sem adicional: MFC ganha igual ao generalista\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • 10% adicional: MFC ganha 10% a mais (R$ 1.500/mês extra)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • 10% adicional: MFC ganha 10% a mais (R$ 1.500/mês extra)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • 20% adicional: MFC ganha 20% a mais (R$ 3.000/mês extra)\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • 20% adicional: MFC ganha 20% a mais (R$ 3.000/mês extra)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"CENÁRIO BASE PARA ANÁLISES:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCENÁRIO BASE PARA ANÁLISES:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Bolsa: MEC + MS (R$ 8.106,90/mês)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Bolsa: MEC + MS (R$ 8.106,90/mês)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Adicional por especialidade: 0%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Adicional por especialidade: 0%\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Preceptoria: R$ 4.000/mês por preceptor\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Preceptoria: R$ 4.000/mês por preceptor\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Incentivo federal: R$ 4.500/mês por equipe com residente\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Incentivo federal: R$ 4.500/mês por equipe com residente\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   • Custos operacionais: R$ 50.000/ano\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   • Custos operacionais: R$ 50.000/ano\n```\n\n\n:::\n:::\n\n\n---\n\n# Próximos Passos\n\nNo próximo capítulo (Simulação de Cenários), utilizaremos estas funções para:\n\n1. **Executar a simulação completa** do cenário base (15 vagas/ano, 60% retenção)\n2. **Calcular benefícios anuais** por categoria (exames, encaminhamentos, internações)\n3. **Montar o fluxo de caixa** consolidado\n4. **Comparar cenário instantâneo (100% MFC)** vs cenário com expansão gradual\n5. **Calcular todos os indicadores econômicos** (VPL, ROI, RCB, Payback)\n6. **Analisar diferentes cenários de custo** (com/sem adicional por especialidade)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}