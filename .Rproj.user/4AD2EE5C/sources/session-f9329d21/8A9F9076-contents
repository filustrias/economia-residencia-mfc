---
title: "Configuração e Dados de Entrada"
---

# Introdução

Este capítulo apresenta todos os dados de entrada necessários para o modelo de custo-benefício da Residência em Medicina de Família e Comunidade (MFC). 

O objetivo é documentar de forma transparente e reproduzível:

1. De onde vêm os dados (estudos originais)
2. Como os dados foram transformados para uso no modelo
3. Quais são os parâmetros assumidos para o município simulado
4. Quais são os custos unitários utilizados

Ao final deste capítulo, teremos todos os objetos R necessários para executar as simulações nos capítulos seguintes.

---

# Fonte dos Dados: Os Três Estudos do Rio de Janeiro

Os dados utilizados neste modelo provêm de **três estudos de coorte retrospectivos** realizados na cidade do Rio de Janeiro, Brasil. Estes estudos compararam desfechos de saúde entre pacientes atendidos por **Médicos de Família e Comunidade (MFC)** versus **médicos generalistas sem residência em MFC**.

## Características comuns dos estudos

- **Local**: Município do Rio de Janeiro
- **Sistema**: Atenção Primária à Saúde (APS) via Estratégia Saúde da Família
- **População total**: Aproximadamente 600.000 pacientes cadastrados
- **Composição da amostra**: 
  - **33,6%** dos pacientes eram atendidos por MFC
  - **66,4%** dos pacientes eram atendidos por generalistas
- **Período**: 2013 a 2018 (variando por estudo)

## Os três estudos

| Estudo | Desfecho avaliado | Publicação |
|--------|-------------------|------------|
| 1 | Internações por Condições Sensíveis à APS (ICSAP) | PLOS Global Public Health, 2023 |
| 2 | Encaminhamentos para especialistas e exames diagnósticos | BMJ Open, 2023 |
| 3 | Solicitação de exames laboratoriais | BMC Family Practice, 2024 |

## O que é o Risco Relativo (RR)?

O **Risco Relativo (RR)** é uma medida estatística que compara a probabilidade de um evento ocorrer em dois grupos diferentes. No contexto destes estudos:

$$
RR = \frac{\text{Taxa de eventos em pacientes de MFC}}{\text{Taxa de eventos em pacientes de generalistas}}
$$

**Interpretação do RR:**

- **RR = 1,00**: Não há diferença entre MFC e generalistas
- **RR < 1,00**: MFC tem **menor** taxa de eventos (efeito protetor)
- **RR > 1,00**: MFC tem **maior** taxa de eventos

**Exemplo prático:**

- Se RR = 0,50 para solicitação de hemograma, significa que pacientes de MFC têm **metade** da probabilidade de ter hemograma solicitado comparado a pacientes de generalistas.
- Se RR = 0,72 para internações, significa que pacientes de MFC têm **28% menos** internações que pacientes de generalistas.

---

# Configuração Inicial do R

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: setup
#| include: true
#| message: false
#| warning: false

# Este chunk configura o ambiente R para as análises

# Limpar ambiente
rm(list = ls())

# Configurações de exibição
options(
  scipen = 999,           # Evitar notação científica
  digits = 2,             # Casas decimais padrão
  OutDec = ","            # Decimal em português
)

# Função auxiliar para formatar números em português
formatar_numero <- function(x, decimais = 0) {
  format(round(x, decimais), big.mark = ".", decimal.mark = ",", nsmall = decimais)
}
```

---

# Parâmetros do Estudo Original

Aqui definimos as proporções observadas no estudo original. Estes valores são fundamentais para a conversão dos dados para o cenário baseline.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: parametros-estudo
#| include: true
#| message: false
#| warning: false

# Parâmetros do estudo original do Rio de Janeiro
estudo <- list(
  # População total do estudo
  populacao = 600000,
  

  # Proporção de pacientes atendidos por MFC
  # (33,6% da população era atendida por médicos com residência em MFC)
  prop_mfc = 0.336,
  
  # Proporção de pacientes atendidos por generalistas
  # (66,4% da população era atendida por médicos SEM residência em MFC)
  prop_gen = 0.664
)

# Exibir parâmetros
cat("PARÂMETROS DO ESTUDO ORIGINAL\n")
cat("=============================\n\n")
cat("População total:", formatar_numero(estudo$populacao), "pacientes\n")
cat("Proporção MFC:", estudo$prop_mfc * 100, "%\n")
cat("Proporção Generalistas:", estudo$prop_gen * 100, "%\n")
cat("\nVerificação (deve ser 100%):", (estudo$prop_mfc + estudo$prop_gen) * 100, "%\n")
```

---

# Dados Brutos dos Estudos

Agora vamos carregar os dados brutos de cada estudo. Para cada categoria de eventos, temos:

- **Nome do evento** (especialidade, exame ou condição)
- **RR**: Risco Relativo observado no estudo (MFC vs. generalista)
- **Eventos/ano**: Número total de eventos observados por ano na população do estudo

**Importante**: Os valores de "Eventos/ano" representam o que foi **observado** na população mista (33,6% MFC + 66,4% generalistas). Estes valores serão posteriormente convertidos para o cenário baseline de 0% MFC.

## Encaminhamentos Ambulatoriais

Estes são encaminhamentos da APS para consultas com médicos especialistas em ambulatório.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: dados-encaminhamentos-ambulatoriais
#| include: true
#| message: false
#| warning: false

encaminhamentos_ambulatoriais <- data.frame(
  especialidade = c(
    "Cardiologia", "Neurologia", "Psiquiatria", "Dermatologia",
    "Pneumologia", "Doenças infecciosas", "Urologia", "Alergologia",
    "Nefrologia", "Endocrinologia", "Gastroenterologia", "Angiologia",
    "Reumatologia", "Fisioterapia", "Reabilitação", "Oftalmologia",
    "ORL", "Ortopedia", "Ginecologia", "Pré-natal alto risco"
  ),
  rr = c(
    0.40, 0.50, 0.45, 0.49,
    0.54, 0.74, 0.57, 0.54,
    0.63, 0.42, 0.38, 0.35,
    0.47, 1.17, 1.68, 1.09,
    0.71, 0.52, 0.86, 0.66
  ),
  eventos_ano_observado = c(
    2008, 1835, 897, 4144,
    903, 290, 1762, 480,
    603, 1021, 867, 1030,
    830, 2390, 1173, 8713,
    2269, 4934, 738, 991
  ),
  stringsAsFactors = FALSE
)

# Exibir tabela
knitr::kable(
  encaminhamentos_ambulatoriais,
  col.names = c(
    "Especialidade", 
    "RR (MFC vs Gen)", 
    "Eventos/ano (observado)"
  ),
  caption = "Encaminhamentos ambulatoriais - Dados originais do estudo (população mista: 33,6% MFC + 66,4% generalistas)"
)
```

**Interpretação da tabela acima:**

- **Cardiologia (RR = 0,40)**: Pacientes de MFC têm 60% menos encaminhamentos para cardiologia
- **Fisioterapia (RR = 1,17)**: Pacientes de MFC têm 17% mais encaminhamentos para fisioterapia
- **Reabilitação (RR = 1,68)**: Pacientes de MFC têm 68% mais encaminhamentos para reabilitação

Os RR > 1 em Fisioterapia, Reabilitação e Oftalmologia sugerem que MFC pode estar identificando mais necessidades nestas áreas, ou que há diferenças no perfil de pacientes.

## Encaminhamentos Cirúrgicos

Estes são encaminhamentos para avaliação cirúrgica especializada.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: dados-encaminhamentos-cirurgicos
#| include: true
#| message: false
#| warning: false

encaminhamentos_cirurgicos <- data.frame(
  especialidade = c(
    "Cirurgia oftalmológica", 
    "Cirurgia ginecológica", 
    "Cirurgia ortopédica",
    "Cirurgia geral", 
    "Cirurgia plástica", 
    "Cirurgia vascular"
  ),
  rr = c(1.21, 0.87, 1.22, 0.91, 1.19, 0.87),
  eventos_ano_observado = c(4458, 989, 147, 1968, 859, 359),
  stringsAsFactors = FALSE
)

knitr::kable(
  encaminhamentos_cirurgicos,
  col.names = c(
    "Especialidade Cirúrgica", 
    "RR (MFC vs Gen)", 
    "Eventos/ano (observado)"
  ),
  caption = "Encaminhamentos cirúrgicos - Dados originais do estudo"
)
```

**Nota:** Alguns RR > 1 nos encaminhamentos cirúrgicos (oftalmológica, ortopédica, plástica) podem indicar que MFC está sendo mais resolutivo na identificação de casos que realmente necessitam de cirurgia.

## Exames Diagnósticos

Exames de imagem e procedimentos diagnósticos solicitados pela APS.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: dados-exames-diagnosticos
#| include: true
#| message: false
#| warning: false

exames_diagnosticos <- data.frame(
  exame = c(
    "Ecocardiograma", 
    "Espirometria", 
    "Colonoscopia", 
    "Endoscopia digestiva alta (EDA)", 
    "Teste ergométrico", 
    "Mamografia"
  ),
  rr = c(0.66, 0.96, 0.76, 0.49, 0.72, 0.98),
  eventos_ano_observado = c(1201, 385, 510, 1090, 431, 2424),
  custo_sigtap = c(39.94, 13.20, 86.00, 48.16, 30.00, 45.00),
  stringsAsFactors = FALSE
)

knitr::kable(
  exames_diagnosticos,
  col.names = c(
    "Exame", 
    "RR (MFC vs Gen)", 
    "Eventos/ano (observado)",
    "Custo SIGTAP (R$)"
  ),
  caption = "Exames diagnósticos - Dados originais do estudo com custos SIGTAP 2024"
)
```

## Exames Laboratoriais

Exames de sangue, urina e outros testes laboratoriais.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: dados-exames-laboratoriais
#| include: true
#| message: false
#| warning: false

exames_laboratoriais <- data.frame(
  exame = c(
    "Hemograma", "Creatinina", "Ureia", "Sódio", "Potássio", "Glicose",
    "Hemoglobina glicada", "Colesterol total", "HDL", "LDL", "Triglicerídeos",
    "Ácido úrico", "TSH", "T3", "T4", "T4 livre", "Bilirrubina", "AST", "ALT",
    "Fosfatase alcalina", "Gama-GT", "VHS", "Ova e parasitas", "Urinálise",
    "Cálcio", "LH", "FSH", "Rubéola IgG", "Rubéola IgM", "PSA"
  ),
  rr = c(
    0.53, 0.85, 0.29, 0.42, 0.73, 0.46, 0.64, 0.81, 0.94, 0.41, 0.82,
    0.23, 0.71, 0.08, 0.13, 0.56, 0.78, 0.48, 0.47, 0.69, 0.64, 0.74,
    0.09, 0.67, 0.44, 0.56, 0.60, 0.48, 0.47, 0.36
  ),
  eventos_ano_observado = c(
    51757, 43746, 22577, 10517, 18265, 9072, 25720, 34673, 31127,
    22163, 33828, 15603, 11679, 791, 886, 5432, 2304, 9181, 9363,
    3505, 4386, 1957, 604, 41333, 1866, 674, 863, 210, 216, 4365
  ),
  custo_sigtap = c(
    4.11, 1.85, 1.85, 1.85, 1.85, 1.85, 7.86, 1.85, 3.51, 3.51, 3.51,
    1.85, 8.96, 8.71, 8.71, 11.60, 2.01, 2.01, 2.01, 2.01, 3.51, 2.63, 
    1.65, 3.70, 1.85, 10.15, 10.15, 18.55, 18.55, 16.42
  ),
  stringsAsFactors = FALSE
)

knitr::kable(
  exames_laboratoriais,
  col.names = c(
    "Exame", 
    "RR (MFC vs Gen)", 
    "Eventos/ano (observado)",
    "Custo SIGTAP (R$)"
  ),
  caption = "Exames laboratoriais - Dados originais do estudo com custos SIGTAP 2024"
)
```

**Destaques nos exames laboratoriais:**

- **T3 (RR = 0,08)**: MFC solicita 92% menos T3 que generalistas
- **T4 (RR = 0,13)**: MFC solicita 87% menos T4 que generalistas
- **Ova e parasitas (RR = 0,09)**: MFC solicita 91% menos este exame
- **Ácido úrico (RR = 0,23)**: MFC solicita 77% menos

Estes resultados sugerem que MFC é mais criterioso na solicitação de exames, evitando exames desnecessários.

## Internações por Condições Sensíveis à Atenção Primária (ICSAP)

As **ICSAP** são condições de saúde para as quais uma APS efetiva deveria reduzir o risco de internação hospitalar. São consideradas um indicador de qualidade da atenção primária.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: dados-internacoes
#| include: true
#| message: false
#| warning: false

internacoes_icsap <- data.frame(
  condicao = c(
    "Hipertensão", 
    "Diabetes mellitus", 
    "AVC (Acidente Vascular Cerebral)", 
    "Angina pectoris",
    "Insuficiência cardíaca", 
    "Epilepsia", 
    "Asma", 
    "Complicações da gravidez",
    "Gastroenterite", 
    "Pneumonia em crianças", 
    "Pneumonia em adultos",
    "Infecção de pele", 
    "Infecções de ouvido, nariz e garganta", 
    "Doença inflamatória pélvica"
  ),
  rr = c(
    0.83, 0.76, 0.74, 0.62, 
    0.52, 0.79, 0.35, 0.78, 
    0.45, 0.57, 0.36, 
    0.82, 1.06, 0.59
  ),
  eventos_ano_observado = c(
    128, 160, 244, 271, 
    230, 86, 54, 136, 
    45, 114, 116, 
    331, 28, 41
  ),
  custo_aih = c(
    761.35, 1178.17, 1756.62, 4774.49, 
    2553.91, 957.47, 853.21, 646.69,
    527.15, 1969.07, 1969.07, 
    679.82, 502.60, 612.67
  ),
  stringsAsFactors = FALSE
)

knitr::kable(
  internacoes_icsap,
  col.names = c(
    "Condição", 
    "RR (MFC vs Gen)", 
    "Internações/ano (observado)",
    "Custo médio AIH (R$)"
  ),
  caption = "Internações por ICSAP - Dados originais do estudo com custos AIH médios"
)
```

**Destaques nas internações:**

- **Asma (RR = 0,35)**: Pacientes de MFC têm 65% menos internações por asma
- **Pneumonia adultos (RR = 0,36)**: 64% menos internações
- **Insuficiência cardíaca (RR = 0,52)**: 48% menos internações
- **Gastroenterite (RR = 0,45)**: 55% menos internações

Estes são os desfechos mais relevantes economicamente, pois internações têm alto custo.

---

# Conversão para Cenário Baseline (0% MFC)

## Por que precisamos converter os dados?

Os dados observados no estudo refletem uma população **mista**: 33,6% dos pacientes eram atendidos por MFC e 66,4% por generalistas. 

Para nossa simulação, precisamos saber: **"Quantos eventos teríamos se TODOS os pacientes fossem atendidos por generalistas (0% MFC)?"**

Este é o nosso **cenário baseline** - o ponto de partida antes de qualquer investimento em residência MFC.

## A fórmula de conversão

O valor observado no estudo pode ser expresso como uma média ponderada:

$$
\text{Valor}_{observado} = (\text{prop}_{MFC} \times \text{Taxa}_{MFC}) + (\text{prop}_{Gen} \times \text{Taxa}_{Gen})
$$

Sabemos que $\text{Taxa}_{MFC} = RR \times \text{Taxa}_{Gen}$, então:

$$
\text{Valor}_{observado} = (\text{prop}_{MFC} \times RR \times \text{Taxa}_{Gen}) + (\text{prop}_{Gen} \times \text{Taxa}_{Gen})
$$

$$
\text{Valor}_{observado} = \text{Taxa}_{Gen} \times (\text{prop}_{MFC} \times RR + \text{prop}_{Gen})
$$

Isolando a taxa de generalistas (que é o que queremos para 0% MFC):

$$
\text{Taxa}_{Gen} = \frac{\text{Valor}_{observado}}{\text{prop}_{MFC} \times RR + \text{prop}_{Gen}}
$$

Substituindo os valores do estudo (prop_MFC = 0,336 e prop_Gen = 0,664):

$$
\text{Taxa}_{Gen} = \frac{\text{Valor}_{observado}}{0,336 \times RR + 0,664}
$$

## Implementação em R

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: funcao-conversao
#| include: true
#| message: false
#| warning: false

converter_para_baseline <- function(valor_observado, 
                                     rr, 
                                     prop_mfc = 0.336, 
                                     prop_gen = 0.664,
                                     pop_estudo = 600000,
                                     pop_alvo = 500000) {
  #' Converte valor observado no estudo para cenário baseline (0% MFC)
  #' 
  #' @param valor_observado Número de eventos observados no estudo
  #' @param rr Risco relativo (MFC vs generalista)
  #' @param prop_mfc Proporção de pacientes atendidos por MFC no estudo

  #' @param prop_gen Proporção de pacientes atendidos por generalistas no estudo
  #' @param pop_estudo População do estudo original
  #' @param pop_alvo População do município simulado
  #'
  #' @return Lista com valores para 0% MFC em diferentes populações
  
  # Calcular denominador da fórmula
  denominador <- (prop_mfc * rr) + prop_gen
  
  # Taxa de eventos para 100% generalistas (0% MFC) - população original
  taxa_baseline_600k <- valor_observado / denominador
  
  # Ajustar para população alvo (500.000 habitantes)
  fator_populacao <- pop_alvo / pop_estudo
  taxa_baseline_500k <- taxa_baseline_600k * fator_populacao
  
  # Retornar resultados
  return(list(
    baseline_600k = taxa_baseline_600k,
    baseline_500k = taxa_baseline_500k,
    fator_conversao = 1 / denominador
  ))
}
```

## Exemplo de aplicação da conversão

Vamos aplicar a conversão ao **hemograma** para ilustrar o processo:

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: exemplo-conversao
#| include: true
#| message: false
#| warning: false

# Dados do hemograma
hemograma_observado <- 51757  # eventos/ano observados no estudo
hemograma_rr <- 0.53          # RR do MFC vs generalista

# Aplicar conversão
resultado_hemograma <- converter_para_baseline(
  valor_observado = hemograma_observado,
  rr = hemograma_rr
)

cat("EXEMPLO DE CONVERSÃO: HEMOGRAMA\n")
cat("================================\n\n")
cat("Dados de entrada:\n")
cat("  - Eventos observados no estudo:", formatar_numero(hemograma_observado), "/ano\n")
cat("  - RR (MFC vs Generalista):", hemograma_rr, "\n")
cat("  - Proporção MFC no estudo: 33,6%\n")
cat("  - Proporção Generalistas no estudo: 66,4%\n\n")

cat("Cálculo:\n")
cat("  Denominador = (0,336 × 0,53) + 0,664 =", (0.336 * 0.53) + 0.664, "\n")
cat("  Fator de conversão = 1 /", round((0.336 * 0.53) + 0.664, 4), "=", 
    round(resultado_hemograma$fator_conversao, 4), "\n\n")

cat("Resultados:\n")
cat("  - Baseline (0% MFC) para 600.000 hab:", formatar_numero(resultado_hemograma$baseline_600k), "/ano\n")
cat("  - Baseline (0% MFC) para 500.000 hab:", formatar_numero(resultado_hemograma$baseline_500k), "/ano\n\n")

cat("Interpretação:\n")
cat("  Se não houvesse NENHUM MFC na população (todos generalistas),\n")
cat("  teríamos", formatar_numero(resultado_hemograma$baseline_500k), "hemogramas/ano em 500.000 habitantes.\n")
cat("  Isso representa um aumento de", 
    round((resultado_hemograma$baseline_600k / hemograma_observado - 1) * 100, 1), 
    "% em relação ao observado.\n")
```

## Aplicar conversão a todos os dados

Agora aplicamos a conversão a todos os dataframes:

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: aplicar-conversao-todos
#| include: true
#| message: false
#| warning: false

# Função auxiliar para adicionar colunas de baseline a um dataframe
adicionar_colunas_baseline <- function(df, 
                                        col_eventos = "eventos_ano_observado", 
                                        col_rr = "rr") {
  
  # Criar colunas vazias
  df$baseline_600k <- NA
  df$baseline_500k <- NA
  
  # Calcular para cada linha
  for (i in 1:nrow(df)) {
    resultado <- converter_para_baseline(
      valor_observado = df[[col_eventos]][i],
      rr = df[[col_rr]][i]
    )
    df$baseline_600k[i] <- resultado$baseline_600k
    df$baseline_500k[i] <- resultado$baseline_500k
  }
  
  return(df)
}

# Aplicar a todos os dataframes
encaminhamentos_ambulatoriais <- adicionar_colunas_baseline(encaminhamentos_ambulatoriais)
encaminhamentos_cirurgicos <- adicionar_colunas_baseline(encaminhamentos_cirurgicos)
exames_diagnosticos <- adicionar_colunas_baseline(exames_diagnosticos)
exames_laboratoriais <- adicionar_colunas_baseline(exames_laboratoriais)
internacoes_icsap <- adicionar_colunas_baseline(internacoes_icsap)

cat("Conversão aplicada a todos os datasets!\n")
```

## Tabelas com valores convertidos

### Encaminhamentos Ambulatoriais - Valores Convertidos

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: tabela-conversao-encam-amb
#| include: true
#| message: false
#| warning: false

knitr::kable(
  encaminhamentos_ambulatoriais[, c("especialidade", "rr", "eventos_ano_observado", 
                                     "baseline_600k", "baseline_500k")],
  col.names = c(
    "Especialidade", 
    "RR", 
    "Observado (600k)", 
    "Baseline 0% MFC (600k)",
    "Baseline 0% MFC (500k)"
  ),
  digits = c(0, 2, 0, 0, 0),
  caption = "Encaminhamentos ambulatoriais - Comparação entre valores observados e baseline"
)
```

### Exames Laboratoriais - Valores Convertidos (10 principais)

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: tabela-conversao-exames-lab
#| include: true
#| message: false
#| warning: false

# Mostrar os 10 exames com maior volume
top10_lab <- head(exames_laboratoriais[order(-exames_laboratoriais$eventos_ano_observado), ], 10)

knitr::kable(
  top10_lab[, c("exame", "rr", "eventos_ano_observado", "baseline_600k", "baseline_500k")],
  col.names = c(
    "Exame", 
    "RR", 
    "Observado (600k)", 
    "Baseline 0% MFC (600k)",
    "Baseline 0% MFC (500k)"
  ),
  digits = c(0, 2, 0, 0, 0),
  caption = "Top 10 exames laboratoriais por volume - Valores convertidos para baseline"
)
```

### Internações ICSAP - Valores Convertidos

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: tabela-conversao-icsap
#| include: true
#| message: false
#| warning: false

knitr::kable(
  internacoes_icsap[, c("condicao", "rr", "eventos_ano_observado", 
                        "baseline_600k", "baseline_500k", "custo_aih")],
  col.names = c(
    "Condição", 
    "RR", 
    "Observado (600k)", 
    "Baseline 0% MFC (600k)",
    "Baseline 0% MFC (500k)",
    "Custo AIH (R$)"
  ),
  digits = c(0, 2, 0, 0, 0, 2),
  caption = "Internações ICSAP - Valores convertidos para baseline com custos"
)
```

---

# Resumo dos Valores Baseline

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: resumo-baseline
#| include: true
#| message: false
#| warning: false

# Calcular totais por categoria
resumo_baseline <- data.frame(
  categoria = c(
    "Encaminhamentos ambulatoriais",
    "Encaminhamentos cirúrgicos",
    "Exames diagnósticos",
    "Exames laboratoriais",
    "Internações ICSAP"
  ),
  total_observado = c(
    sum(encaminhamentos_ambulatoriais$eventos_ano_observado),
    sum(encaminhamentos_cirurgicos$eventos_ano_observado),
    sum(exames_diagnosticos$eventos_ano_observado),
    sum(exames_laboratoriais$eventos_ano_observado),
    sum(internacoes_icsap$eventos_ano_observado)
  ),
  total_baseline_500k = c(
    sum(encaminhamentos_ambulatoriais$baseline_500k),
    sum(encaminhamentos_cirurgicos$baseline_500k),
    sum(exames_diagnosticos$baseline_500k),
    sum(exames_laboratoriais$baseline_500k),
    sum(internacoes_icsap$baseline_500k)
  )
)

# Calcular variação percentual
resumo_baseline$variacao_pct <- round(
  (resumo_baseline$total_baseline_500k / (resumo_baseline$total_observado * 500000/600000) - 1) * 100, 
  1
)

knitr::kable(
  resumo_baseline,
  col.names = c(
    "Categoria", 
    "Total Observado (600k)", 
    "Total Baseline 0% MFC (500k)",
    "Variação (%)"
  ),
  format.args = list(big.mark = ".", decimal.mark = ","),
  caption = "Resumo dos valores baseline por categoria"
)
```

**Interpretação:**

- Valores com **variação positiva** indicam que, sem MFC, teríamos **mais** eventos
- Valores com **variação negativa** indicam que, sem MFC, teríamos **menos** eventos (RR > 1 em média)
- A maioria das categorias mostra aumento, indicando que MFC reduz eventos

---

# Parâmetros do Município Simulado

Agora definimos os parâmetros do município fictício onde simularemos a implantação do programa de residência.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: parametros-municipio
#| include: true
#| message: false
#| warning: false

municipio <- list(
  # Identificação
  nome = "Esperança",
  
  # População
  populacao = 500000,
  
  # Cobertura da Estratégia Saúde da Família
  cobertura_esf = 0.80,  # 80% da população coberta pela ESF
  pop_coberta = 500000 * 0.80,  # 400.000 pessoas
  
  # Estrutura de equipes
  pop_por_equipe = 4000,  # População por equipe ESF
  n_equipes = (500000 * 0.80) / 4000,  # 100 equipes
  
  # Médicos
  n_medicos = 100,  # 1 médico por equipe
  prop_mfc_inicial = 0  # Começa com 0% de MFC
)

cat("MUNICÍPIO SIMULADO: ", municipio$nome, "\n")
cat("=========================================\n\n")
cat("População total:", formatar_numero(municipio$populacao), "habitantes\n")
cat("Cobertura ESF:", municipio$cobertura_esf * 100, "%\n")
cat("População coberta:", formatar_numero(municipio$pop_coberta), "pessoas\n\n")
cat("Número de equipes ESF:", municipio$n_equipes, "\n")
cat("Número de médicos na APS:", municipio$n_medicos, "\n")
cat("Proporção inicial de MFC:", municipio$prop_mfc_inicial * 100, "%\n")
```

---

# Parâmetros do Programa de Residência

Aqui definimos os parâmetros do programa de residência a ser implantado.

**Importante:** Estamos usando **15 vagas por ano** para que, ao final de 10 anos, tenhamos aproximadamente 100% de cobertura MFC.

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: parametros-programa
#| include: true
#| message: false
#| warning: false

programa <- list(
  # Estrutura do programa
  vagas_por_ano = 15,        # Vagas abertas a cada ano
  duracao_anos = 2,          # Duração da residência
  
  # Preceptoria (MFC contratados para supervisionar residentes)
  n_preceptores_inicial = 4,  # MFC contratados no ano 1
  razao_preceptor_residente = 4,  # 1 preceptor para cada 4 residentes
  
  # Custos mensais
  bolsa_mec = 4106.90,       # Bolsa paga pelo MEC
  complemento_ms = 4000.00,   # Complemento do Ministério da Saúde
  bolsa_total = 4106.90 + 4000.00,  # Total: R$ 8.106,90/mês
  
  custo_preceptoria = 4000.00,  # Adicional de preceptoria por preceptor
  
  # Incentivos federais (receita, não custo)
  incentivo_equipe_residente = 4500.00,  # Por equipe que recebe residente (mensal)
  
  # Custos operacionais
  custo_operacional_anual = 50000,  # Coordenação, materiais, etc.
  
  # Cenários de retenção (% dos formados que ficam no município)
  taxa_retencao_pessimista = 0.40,
  taxa_retencao_moderada = 0.60,
  taxa_retencao_otimista = 0.80
)

cat("PROGRAMA DE RESIDÊNCIA\n")
cat("======================\n\n")
cat("Vagas por ano:", programa$vagas_por_ano, "\n")
cat("Duração:", programa$duracao_anos, "anos\n")
cat("Preceptores iniciais:", programa$n_preceptores_inicial, "\n\n")

cat("CUSTOS MENSAIS:\n")
cat("  Bolsa MEC: R$", formatar_numero(programa$bolsa_mec, 2), "\n")
cat("  Complemento MS: R$", formatar_numero(programa$complemento_ms, 2), "\n")
cat("  Bolsa total/residente: R$", formatar_numero(programa$bolsa_total, 2), "\n")
cat("  Adicional preceptoria: R$", formatar_numero(programa$custo_preceptoria, 2), "\n\n")

cat("INCENTIVO FEDERAL:\n")
cat("  Por equipe com residente: R$", formatar_numero(programa$incentivo_equipe_residente, 2), "/mês\n\n")

cat("CENÁRIOS DE RETENÇÃO:\n")
cat("  Pessimista:", programa$taxa_retencao_pessimista * 100, "%\n")
cat("  Moderado:", programa$taxa_retencao_moderada * 100, "%\n")
cat("  Otimista:", programa$taxa_retencao_otimista * 100, "%\n")
```

---

# Parâmetros de Custos

## Custos de Consultas Especializadas

O valor SIGTAP para consulta médica é muito baixo (R$ 10,00) e não reflete o custo real. Usaremos cenários:

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: custos-consulta
#| include: true
#| message: false
#| warning: false

custos_consulta <- data.frame(
  cenario = c("SIGTAP", "Conservador", "Moderado (base)", "Alto"),
  valor = c(10.00, 30.00, 50.00, 80.00),
  justificativa = c(
    "Valor de repasse federal",
    "Estimativa mínima",
    "Estimativa razoável",
    "Inclui custos indiretos"
  )
)

knitr::kable(
  custos_consulta,
  col.names = c("Cenário", "Valor (R$)", "Justificativa"),
  caption = "Cenários de custo por consulta especializada"
)

# Definir valor base
custo_consulta_base <- 50.00
cat("\nValor utilizado nas análises: R$", custo_consulta_base, "(cenário moderado)\n")
```

## Fatores de Correção para Internações

Os valores de AIH (Autorização de Internação Hospitalar) representam apenas o repasse federal e subestimam o custo real da internação. Usaremos fatores de correção:

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: fatores-correcao-aih
#| include: true
#| message: false
#| warning: false

fatores_aih <- data.frame(
  cenario = c("AIH pura", "Conservador", "Moderado (base)", "Alto"),
  fator = c(1.0, 1.25, 1.5, 2.0),
  justificativa = c(
    "Apenas repasse federal",
    "Inclui complementação estadual",
    "Inclui custos operacionais",
    "Hospitais universitários/alta complexidade"
  )
)

knitr::kable(
  fatores_aih,
  col.names = c("Cenário", "Fator", "Justificativa"),
  caption = "Fatores de correção AIH → Custo real"
)

# Definir fator base
fator_aih_base <- 1.5
cat("\nFator utilizado nas análises:", fator_aih_base, "(cenário moderado)\n")
```

---

# Parâmetros Econômicos

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: parametros-economicos
#| include: true
#| message: false
#| warning: false

economico <- list(
  # Taxa de desconto
  taxa_desconto = 0.05,  # 5% ao ano - recomendação do Ministério da Saúde
  
  # Horizonte temporal
  horizonte_anos = 10
)

cat("PARÂMETROS ECONÔMICOS\n")
cat("=====================\n\n")
cat("Taxa de desconto:", economico$taxa_desconto * 100, "% ao ano\n")
cat("Fonte: Diretrizes Metodológicas - Ministério da Saúde, 2014\n\n")
cat("Horizonte temporal:", economico$horizonte_anos, "anos\n")
```

**O que é a taxa de desconto?**

A taxa de desconto reflete o conceito de que dinheiro hoje vale mais que dinheiro no futuro. 

- Uma taxa de 5% significa que R$ 100 daqui a 1 ano equivalem a R$ 95,24 hoje
- Isso é importante porque os custos do programa ocorrem nos primeiros anos, enquanto os benefícios se acumulam ao longo do tempo
- A taxa de 5% é recomendada pelo Ministério da Saúde para avaliações econômicas em saúde no Brasil

---

# Resumo dos Objetos Criados

```{r include=TRUE, message=FALSE, warning=FALSE}
#| label: resumo-objetos
#| include: true
#| message: false
#| warning: false

cat("OBJETOS CRIADOS NESTE CAPÍTULO\n")
cat("==============================\n\n")

cat("DADOS DOS ESTUDOS:\n")
cat("  - encaminhamentos_ambulatoriais:", nrow(encaminhamentos_ambulatoriais), "especialidades\n")
cat("  - encaminhamentos_cirurgicos:", nrow(encaminhamentos_cirurgicos), "especialidades\n")
cat("  - exames_diagnosticos:", nrow(exames_diagnosticos), "exames\n")
cat("  - exames_laboratoriais:", nrow(exames_laboratoriais), "exames\n")
cat("  - internacoes_icsap:", nrow(internacoes_icsap), "condições\n\n")

cat("PARÂMETROS:\n")
cat("  - estudo: proporções do estudo original\n")
cat("  - municipio: características do município simulado\n")
cat("  - programa: parâmetros do programa de residência\n")
cat("  - economico: taxa de desconto e horizonte\n\n")

cat("VALORES DE REFERÊNCIA:\n")
cat("  - custo_consulta_base: R$", custo_consulta_base, "\n")
cat("  - fator_aih_base:", fator_aih_base, "\n")
```

---

# Próximos Passos

No próximo capítulo, criaremos as **funções de simulação** que utilizarão estes dados para:

1. Calcular eventos esperados para qualquer nível de cobertura MFC
2. Simular a expansão do programa ao longo dos anos
3. Calcular custos e benefícios anuais
