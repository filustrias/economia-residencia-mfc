---
title: "Cenário Combinado: Investimento em Formação e Fixação"
---

# Introdução

Este capítulo analisa o **investimento municipal em formação e fixação de médicos de família**.

**Lógica de política pública de saúde:**

- O município **precisa** investir em saúde
- A pergunta não é "como gastar menos", mas sim "**o investimento se paga?**"
- O objetivo é formar profissionais qualificados **E** mantê-los no município

**Premissa central:**

Municípios que investem mais em condições de trabalho (incluindo adicional por especialidade) conseguem reter mais profissionais:

| Adicional por Especialidade | Taxa de Retenção Esperada |
|-----------------------------|---------------------------|
| 0% (sem incentivo) | 40% (baixa) |
| 10% | 57% |
| 20% | 73% |
| 30% (investimento alto) | 90% (alta) |

---

# Preparação

```{r}
#| label: setup
#| include: true
#| message: false
#| warning: false

options(scipen = 999, digits = 2, OutDec = ",")

formatar_numero <- function(x, decimais = 0) {
  format(round(x, decimais), big.mark = ".", decimal.mark = ",", nsmall = decimais)
}

formatar_moeda <- function(x) {
  paste0("R$ ", formatar_numero(x))
}

# Parâmetros
municipio <- list(n_equipes = 100)

custos_pessoal <- list(
  salario_base_medico = 16000,
  encargos_trabalhistas_pct = 0.70,
  adicional_preceptoria_pct = 0.10,
  bolsa_mec = 4106.90,
  complemento_ms = 4000.00
)

custos_pessoal$custo_medico_total <- custos_pessoal$salario_base_medico * 
                                      (1 + custos_pessoal$encargos_trabalhistas_pct)
custos_pessoal$custo_preceptor_total <- custos_pessoal$custo_medico_total + 
                                         custos_pessoal$salario_base_medico * 0.10 * 1.70
custos_pessoal$bolsa_total_mec_ms <- custos_pessoal$bolsa_mec + custos_pessoal$complemento_ms

programa <- list(
  custo_operacional_anual = 50000,
  incentivo_equipe_residente = 4500
)

economico <- list(
  taxa_desconto = 0.05,
  horizonte_anos = 10,
  fator_correcao_aih = 1.5
)
```

---

# Funções de Cálculo

```{r}
#| label: funcoes

converter_para_baseline <- function(valor_observado, rr, 
                                     prop_mfc = 0.336, prop_gen = 0.664,
                                     pop_estudo = 600000, pop_alvo = 500000) {
  denominador <- (prop_mfc * rr) + prop_gen
  taxa_baseline_600k <- valor_observado / denominador
  taxa_baseline_500k <- taxa_baseline_600k * (pop_alvo / pop_estudo)
  return(taxa_baseline_500k)
}

calcular_economia_100pct <- function(fator_aih = 1.5) {
  custo_consulta <- 50.00
  
  enc_amb <- data.frame(
    rr = c(0.40, 0.50, 0.45, 0.49, 0.54, 0.74, 0.57, 0.54,
           0.63, 0.42, 0.38, 0.35, 0.47, 1.17, 1.68, 1.09,
           0.71, 0.52, 0.86, 0.66),
    obs = c(2008, 1835, 897, 4144, 903, 290, 1762, 480,
            603, 1021, 867, 1030, 830, 2390, 1173, 8713,
            2269, 4934, 738, 991)
  )
  enc_amb$baseline <- mapply(converter_para_baseline, enc_amb$obs, enc_amb$rr)
  enc_amb$economia <- enc_amb$baseline * (1 - enc_amb$rr) * custo_consulta
  
  enc_cir <- data.frame(
    rr = c(1.21, 0.87, 1.22, 0.91, 1.19, 0.87),
    obs = c(4458, 989, 147, 1968, 859, 359)
  )
  enc_cir$baseline <- mapply(converter_para_baseline, enc_cir$obs, enc_cir$rr)
  enc_cir$economia <- enc_cir$baseline * (1 - enc_cir$rr) * custo_consulta
  
  diag <- data.frame(
    rr = c(0.66, 0.96, 0.76, 0.49, 0.72, 0.98),
    obs = c(1201, 385, 510, 1090, 431, 2424),
    custo = c(39.94, 13.20, 86.00, 48.16, 30.00, 45.00)
  )
  diag$baseline <- mapply(converter_para_baseline, diag$obs, diag$rr)
  diag$economia <- diag$baseline * (1 - diag$rr) * diag$custo
  
  lab <- data.frame(
    rr = c(0.53, 0.85, 0.29, 0.42, 0.73, 0.46, 0.64, 0.81, 0.94, 0.41, 0.82,
           0.23, 0.71, 0.08, 0.13, 0.56, 0.78, 0.48, 0.47, 0.69, 0.64, 0.74,
           0.09, 0.67, 0.44, 0.56, 0.60, 0.48, 0.47, 0.36),
    obs = c(51757, 43746, 22577, 10517, 18265, 9072, 25720, 34673, 
            31127, 22163, 33828, 15603, 11679, 791, 886, 5432, 
            2304, 9181, 9363, 3505, 4386, 1957, 604, 41333, 
            1866, 674, 863, 210, 216, 4365),
    custo = c(4.11, 1.85, 1.85, 1.85, 1.85, 1.85, 7.86, 1.85, 3.51, 3.51, 3.51,
              1.85, 8.96, 8.71, 8.71, 11.60, 2.01, 2.01, 2.01, 2.01, 3.51, 2.63, 
              1.65, 3.70, 1.85, 10.15, 10.15, 18.55, 18.55, 16.42)
  )
  lab$baseline <- mapply(converter_para_baseline, lab$obs, lab$rr)
  lab$economia <- lab$baseline * (1 - lab$rr) * lab$custo
  
  icsap <- data.frame(
    rr = c(0.83, 0.76, 0.74, 0.62, 0.52, 0.79, 0.35, 0.78, 
           0.45, 0.57, 0.36, 0.82, 1.06, 0.59),
    obs = c(128, 160, 244, 271, 230, 86, 54, 136, 
            45, 114, 116, 331, 28, 41),
    custo = c(761.35, 1178.17, 1756.62, 4774.49, 2553.91, 957.47, 853.21, 646.69,
              527.15, 1969.07, 1969.07, 679.82, 502.60, 612.67)
  )
  icsap$baseline <- mapply(converter_para_baseline, icsap$obs, icsap$rr)
  icsap$economia <- icsap$baseline * (1 - icsap$rr) * icsap$custo * fator_aih
  
  total <- sum(enc_amb$economia) + sum(enc_cir$economia) + 
           sum(diag$economia) + sum(lab$economia) + sum(icsap$economia)
  return(total)
}

# Função que relaciona investimento com retenção
calcular_retencao <- function(adicional) {
  0.40 + (0.90 - 0.40) * (adicional / 0.30)
}

simular_programa <- function(taxa_retencao = 0.60, adicional_especialidade_pct = 0.10) {
  
  anos <- 0:economico$horizonte_anos
  n_anos <- length(anos)
  
  n_preceptores <- c(0, 4, rep(8, 9))
  n_equipes_escola <- c(0, 8, rep(16, 9))
  n_residentes <- c(0, 16, rep(32, 9))
  
  n_formados_retidos_acum <- numeric(n_anos)
  for (i in 4:n_anos) {
    if (i == 4) {
      n_formados_retidos_acum[i] <- round(16 * taxa_retencao)
    } else {
      n_formados_retidos_acum[i] <- n_formados_retidos_acum[i-1] + round(16 * taxa_retencao)
    }
  }
  
  n_equipes_mfc <- pmin(n_equipes_escola + n_formados_retidos_acum, 100)
  prop_mfc <- n_equipes_mfc / 100
  
  # Economia do modelo
  custo_2med <- 2 * custos_pessoal$custo_medico_total * 12
  custo_1prec_4res <- custos_pessoal$custo_preceptor_total * 12 +
                       4 * custos_pessoal$bolsa_total_mec_ms * 12 -
                       2 * programa$incentivo_equipe_residente * 12
  economia_por_par <- custo_2med - custo_1prec_4res
  economia_modelo <- (n_equipes_escola / 2) * economia_por_par
  
  # Investimento em fixação
  adicional_mensal <- custos_pessoal$salario_base_medico * adicional_especialidade_pct
  investimento_fixacao <- n_formados_retidos_acum * adicional_mensal * 
                           (1 + custos_pessoal$encargos_trabalhistas_pct) * 12
  
  # Custo operacional
  custo_operacional <- c(0, rep(programa$custo_operacional_anual, 10))
  
  # Economia de pessoal
  economia_pessoal <- economia_modelo - investimento_fixacao - custo_operacional
  
  # Benefício em saúde
  economia_100pct <- calcular_economia_100pct(1.5)
  beneficio_saude <- economia_100pct * prop_mfc
  
  # Saldo e VPL
  saldo <- economia_pessoal + beneficio_saude
  fator_vp <- 1 / ((1 + economico$taxa_desconto) ^ anos)
  vpl <- sum(saldo * fator_vp)
  
  return(list(
    vpl = vpl,
    cobertura_final = prop_mfc[n_anos],
    formados_final = n_formados_retidos_acum[n_anos],
    investimento_total = sum(investimento_fixacao),
    beneficio_saude_total = sum(beneficio_saude),
    economia_modelo_total = sum(economia_modelo)
  ))
}
```

---

# Cenários de Investimento

```{r}
#| label: cenarios

cenarios <- data.frame(
  nome = c(
    "Sem investimento em fixação",
    "Investimento baixo",
    "Investimento moderado",
    "Investimento alto",
    "Investimento máximo"
  ),
  adicional_pct = c(0.00, 0.10, 0.20, 0.25, 0.30),
  stringsAsFactors = FALSE
)

cenarios$taxa_retencao <- calcular_retencao(cenarios$adicional_pct)
cenarios$adicional_valor <- custos_pessoal$salario_base_medico * cenarios$adicional_pct

for (i in 1:nrow(cenarios)) {
  r <- simular_programa(cenarios$taxa_retencao[i], cenarios$adicional_pct[i])
  cenarios$vpl[i] <- r$vpl
  cenarios$cobertura[i] <- r$cobertura_final
  cenarios$formados[i] <- r$formados_final
  cenarios$investimento[i] <- r$investimento_total
  cenarios$beneficio_saude[i] <- r$beneficio_saude_total
}
```

## Resumo dos Cenários

```{r}
#| label: tabela-resumo

resumo <- data.frame(
  cenario = cenarios$nome,
  adicional = formatar_moeda(cenarios$adicional_valor),
  retencao = paste0(round(cenarios$taxa_retencao * 100, 0), "%"),
  formados = cenarios$formados,
  cobertura = paste0(round(cenarios$cobertura * 100, 0), "%")
)

knitr::kable(
  resumo,
  col.names = c("Cenário", "Adicional Mensal", "Retenção", "Formados Retidos", "Cobertura MFC"),
  caption = "Cenários de investimento em fixação"
)
```

## Análise Financeira

```{r}
#| label: tabela-financeira

financeiro <- data.frame(
  cenario = cenarios$nome,
  investimento = formatar_moeda(cenarios$investimento),
  beneficio = formatar_moeda(cenarios$beneficio_saude),
  vpl = formatar_moeda(cenarios$vpl),
  viavel = ifelse(cenarios$vpl > 0, "✓ Sim", "✗ Não")
)

knitr::kable(
  financeiro,
  col.names = c("Cenário", "Investimento em Fixação", "Economia em Saúde", "VPL", "Viável?"),
  caption = "Análise financeira (valores acumulados em 10 anos)"
)
```

---

# O Investimento se Paga?

Comparando o cenário sem investimento com o cenário de investimento máximo:

```{r}
#| label: analise-retorno

sem_invest <- cenarios[cenarios$adicional_pct == 0, ]
com_invest <- cenarios[cenarios$adicional_pct == 0.30, ]

# Investimento adicional
invest_adicional <- com_invest$investimento - sem_invest$investimento

# Benefício adicional
beneficio_adicional <- com_invest$beneficio_saude - sem_invest$beneficio_saude

# Retorno
retorno <- beneficio_adicional / invest_adicional

analise <- data.frame(
  item = c(
    "SEM INVESTIMENTO EM FIXAÇÃO",
    "  Adicional por especialidade",
    "  Taxa de retenção",
    "  Formados retidos (10 anos)",
    "  Cobertura MFC final",
    "  Economia em saúde (10 anos)",
    "",
    "COM INVESTIMENTO MÁXIMO",
    "  Adicional por especialidade",
    "  Taxa de retenção",
    "  Formados retidos (10 anos)",
    "  Cobertura MFC final",
    "  Economia em saúde (10 anos)",
    "",
    "ANÁLISE DO INVESTIMENTO",
    "  Investimento adicional em fixação",
    "  Benefício adicional em saúde",
    "  Retorno: cada R$ 1 investido gera",
    "  O investimento se paga?"
  ),
  valor = c(
    "",
    "R$ 0",
    paste0(round(sem_invest$taxa_retencao * 100, 0), "%"),
    sem_invest$formados,
    paste0(round(sem_invest$cobertura * 100, 0), "%"),
    formatar_moeda(sem_invest$beneficio_saude),
    "",
    "",
    formatar_moeda(com_invest$adicional_valor),
    paste0(round(com_invest$taxa_retencao * 100, 0), "%"),
    com_invest$formados,
    paste0(round(com_invest$cobertura * 100, 0), "%"),
    formatar_moeda(com_invest$beneficio_saude),
    "",
    "",
    formatar_moeda(invest_adicional),
    formatar_moeda(beneficio_adicional),
    paste0("R$ ", round(retorno, 2), " em economia"),
    ifelse(retorno > 1, "SIM, com folga!", "Não")
  )
)

knitr::kable(
  analise,
  col.names = c("", ""),
  caption = "Análise do retorno do investimento em fixação"
)
```

---

# Viabilidade de Todos os Cenários

```{r}
#| label: viabilidade

viabilidade <- data.frame(
  cenario = cenarios$nome,
  investimento = formatar_moeda(cenarios$investimento),
  vpl = formatar_moeda(cenarios$vpl),
  viavel = ifelse(cenarios$vpl > 0, "✓ SIM", "✗ NÃO")
)

knitr::kable(
  viabilidade,
  col.names = c("Cenário", "Investimento em Fixação", "VPL", "Economicamente Viável?"),
  caption = "Viabilidade econômica de todos os cenários"
)
```

**Conclusão:** Todos os cenários são economicamente viáveis. O município pode escolher quanto investir sabendo que qualquer nível é sustentável.

---

# Benefícios Além da Economia Financeira

```{r}
#| label: beneficios-qualitativos

beneficios <- data.frame(
  categoria = c(
    "Cobertura populacional",
    "Continuidade do cuidado",
    "Qualidade da atenção",
    "Formação de profissionais",
    "Desenvolvimento institucional",
    "Indicadores de saúde"
  ),
  sem_investimento = c(
    paste0(round(sem_invest$cobertura * 100, 0), "% das equipes com MFC"),
    "Prejudicada pela rotatividade",
    "Variável",
    "Forma, mas não retém",
    "Limitado",
    "Melhora parcial"
  ),
  com_investimento = c(
    paste0(round(com_invest$cobertura * 100, 0), "% das equipes com MFC"),
    "Fortalecida pela fixação",
    "Consistentemente alta",
    "Forma E retém",
    "Sustentável",
    "Melhora expressiva"
  )
)

knitr::kable(
  beneficios,
  col.names = c("Categoria", "Sem Investimento (40% retenção)", "Com Investimento (90% retenção)"),
  caption = "Benefícios qualitativos do investimento em fixação"
)
```

---

# Conclusões

## Principais Achados

1. **Todos os cenários são economicamente viáveis:** Mesmo o cenário de máximo investimento (30% de adicional) apresenta VPL positivo de `r formatar_moeda(com_invest$vpl)`.

2. **O investimento em fixação se paga:** Cada R$ 1,00 investido em adicional por especialidade gera R$ `r round(retorno, 2)` em economia com saúde.

3. **A diferença de cobertura é expressiva:** De `r round(sem_invest$cobertura * 100, 0)`% (sem investimento) para `r round(com_invest$cobertura * 100, 0)`% (com investimento máximo).

4. **Benefícios qualitativos:** Maior retenção significa continuidade do cuidado, melhor vínculo com a comunidade e indicadores de saúde mais favoráveis.

## Recomendação

O município deve decidir o nível de investimento em fixação baseado em seus objetivos de política de saúde, sabendo que:

- **Qualquer nível de investimento é sustentável** do ponto de vista econômico
- **Maior investimento = maior retenção = maior cobertura = melhores resultados**
- **O investimento se paga** através da economia em exames, encaminhamentos e internações

**A decisão não é "se" investir, mas "quanto" investir** - e a análise mostra que mesmo o investimento máximo é economicamente justificável.
