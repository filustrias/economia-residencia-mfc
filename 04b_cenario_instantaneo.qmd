---
title: "Cenário Instantâneo"
---

# Introdução

Este capítulo apresenta um cenário hipotético onde **100% das equipes já têm cobertura MFC desde o ano 0**. É um exercício teórico para demonstrar o potencial máximo de economia.

**Objetivo:** Mostrar qual seria a economia se o município já tivesse 100% de cobertura MFC.

---

# Preparação

```{r}
#| label: setup
#| include: true
#| message: false
#| warning: false

options(scipen = 999, digits = 2, OutDec = ",")

formatar_numero <- function(x, decimais = 0) {
  format(round(x, decimais), big.mark = ".", decimal.mark = ",", nsmall = decimais)
}

formatar_moeda <- function(x) {
  paste0("R$ ", formatar_numero(x))
}

# Parâmetros
municipio <- list(n_equipes = 100)

custos_pessoal <- list(
  salario_base_medico = 16000,
  encargos_trabalhistas_pct = 0.70,
  adicional_preceptoria_pct = 0.10,
  bolsa_mec = 4106.90,
  complemento_ms = 4000.00
)

custos_pessoal$custo_medico_total <- custos_pessoal$salario_base_medico * 
                                      (1 + custos_pessoal$encargos_trabalhistas_pct)

economico <- list(
  taxa_desconto = 0.05,
  horizonte_anos = 10,
  fator_correcao_aih = 1.5
)
```

---

# Função de Economia em Saúde

```{r}
#| label: funcao-economia

converter_para_baseline <- function(valor_observado, rr, 
                                     prop_mfc = 0.336, prop_gen = 0.664,
                                     pop_estudo = 600000, pop_alvo = 500000) {
  denominador <- (prop_mfc * rr) + prop_gen
  taxa_baseline_600k <- valor_observado / denominador
  taxa_baseline_500k <- taxa_baseline_600k * (pop_alvo / pop_estudo)
  return(taxa_baseline_500k)
}

calcular_economia_100pct <- function(fator_aih = 1.5) {
  custo_consulta <- 50.00
  
  enc_amb <- data.frame(
    rr = c(0.40, 0.50, 0.45, 0.49, 0.54, 0.74, 0.57, 0.54,
           0.63, 0.42, 0.38, 0.35, 0.47, 1.17, 1.68, 1.09,
           0.71, 0.52, 0.86, 0.66),
    obs = c(2008, 1835, 897, 4144, 903, 290, 1762, 480,
            603, 1021, 867, 1030, 830, 2390, 1173, 8713,
            2269, 4934, 738, 991)
  )
  enc_amb$baseline <- mapply(converter_para_baseline, enc_amb$obs, enc_amb$rr)
  enc_amb$economia <- enc_amb$baseline * (1 - enc_amb$rr) * custo_consulta
  
  enc_cir <- data.frame(
    rr = c(1.21, 0.87, 1.22, 0.91, 1.19, 0.87),
    obs = c(4458, 989, 147, 1968, 859, 359)
  )
  enc_cir$baseline <- mapply(converter_para_baseline, enc_cir$obs, enc_cir$rr)
  enc_cir$economia <- enc_cir$baseline * (1 - enc_cir$rr) * custo_consulta
  
  diag <- data.frame(
    rr = c(0.66, 0.96, 0.76, 0.49, 0.72, 0.98),
    obs = c(1201, 385, 510, 1090, 431, 2424),
    custo = c(39.94, 13.20, 86.00, 48.16, 30.00, 45.00)
  )
  diag$baseline <- mapply(converter_para_baseline, diag$obs, diag$rr)
  diag$economia <- diag$baseline * (1 - diag$rr) * diag$custo
  
  lab <- data.frame(
    rr = c(0.53, 0.85, 0.29, 0.42, 0.73, 0.46, 0.64, 0.81, 0.94, 0.41, 0.82,
           0.23, 0.71, 0.08, 0.13, 0.56, 0.78, 0.48, 0.47, 0.69, 0.64, 0.74,
           0.09, 0.67, 0.44, 0.56, 0.60, 0.48, 0.47, 0.36),
    obs = c(51757, 43746, 22577, 10517, 18265, 9072, 25720, 34673, 
            31127, 22163, 33828, 15603, 11679, 791, 886, 5432, 
            2304, 9181, 9363, 3505, 4386, 1957, 604, 41333, 
            1866, 674, 863, 210, 216, 4365),
    custo = c(4.11, 1.85, 1.85, 1.85, 1.85, 1.85, 7.86, 1.85, 3.51, 3.51, 3.51,
              1.85, 8.96, 8.71, 8.71, 11.60, 2.01, 2.01, 2.01, 2.01, 3.51, 2.63, 
              1.65, 3.70, 1.85, 10.15, 10.15, 18.55, 18.55, 16.42)
  )
  lab$baseline <- mapply(converter_para_baseline, lab$obs, lab$rr)
  lab$economia <- lab$baseline * (1 - lab$rr) * lab$custo
  
  icsap <- data.frame(
    rr = c(0.83, 0.76, 0.74, 0.62, 0.52, 0.79, 0.35, 0.78, 
           0.45, 0.57, 0.36, 0.82, 1.06, 0.59),
    obs = c(128, 160, 244, 271, 230, 86, 54, 136, 
            45, 114, 116, 331, 28, 41),
    custo = c(761.35, 1178.17, 1756.62, 4774.49, 2553.91, 957.47, 853.21, 646.69,
              527.15, 1969.07, 1969.07, 679.82, 502.60, 612.67)
  )
  icsap$baseline <- mapply(converter_para_baseline, icsap$obs, icsap$rr)
  icsap$economia <- icsap$baseline * (1 - icsap$rr) * icsap$custo * fator_aih
  
  total <- sum(enc_amb$economia) + sum(enc_cir$economia) + 
           sum(diag$economia) + sum(lab$economia) + sum(icsap$economia)
  return(total)
}

economia_100pct <- calcular_economia_100pct(economico$fator_correcao_aih)
```

---

# Cenário Instantâneo: 100% MFC desde o Ano 0

```{r}
#| label: cenario-instantaneo

# Neste cenário, assumimos que 100 médicos já são MFC
# Eles recebem adicional por especialidade de 10%

adicional_pct <- 0.10
adicional_mensal <- custos_pessoal$salario_base_medico * adicional_pct

# Custo anual do investimento em fixação (100 médicos)
investimento_fixacao_anual <- municipio$n_equipes * adicional_mensal * 
                               (1 + custos_pessoal$encargos_trabalhistas_pct) * 12

# Benefício em saúde (100% de cobertura)
beneficio_saude_anual <- economia_100pct

# Saldo anual
saldo_anual <- beneficio_saude_anual - investimento_fixacao_anual
```

## Fluxo de Caixa

```{r}
#| label: fluxo-instantaneo

anos <- 0:10

fluxo <- data.frame(
  ano = anos,
  investimento = investimento_fixacao_anual,
  beneficio = beneficio_saude_anual,
  saldo = saldo_anual
)

# Ano 0 não tem investimento nem benefício (é o ponto de partida)
fluxo$investimento[1] <- 0
fluxo$beneficio[1] <- 0
fluxo$saldo[1] <- 0

# Valor presente
fator_vp <- 1 / ((1 + economico$taxa_desconto) ^ anos)
fluxo$saldo_vp <- fluxo$saldo * fator_vp
fluxo$saldo_vp_acum <- cumsum(fluxo$saldo_vp)

fluxo_tab <- data.frame(
  ano = fluxo$ano,
  investimento = round(fluxo$investimento / 1000, 1),
  beneficio = round(fluxo$beneficio / 1000, 1),
  saldo = round(fluxo$saldo / 1000, 1),
  saldo_vp_acum = round(fluxo$saldo_vp_acum / 1000, 1)
)

knitr::kable(
  fluxo_tab,
  col.names = c("Ano", "Investimento (R$ mil)", "Benefício Saúde (R$ mil)", 
                "Saldo (R$ mil)", "Saldo VP Acum. (R$ mil)"),
  caption = "Fluxo de caixa do cenário instantâneo"
)
```

## Indicadores

```{r}
#| label: indicadores-instantaneo

vpl_instantaneo <- sum(fluxo$saldo_vp)

indicadores <- data.frame(
  indicador = c(
    "Cobertura MFC",
    "Investimento anual em fixação",
    "Economia anual em saúde",
    "Saldo anual",
    "VPL (10 anos)"
  ),
  valor = c(
    "100%",
    formatar_moeda(investimento_fixacao_anual),
    formatar_moeda(beneficio_saude_anual),
    formatar_moeda(saldo_anual),
    formatar_moeda(vpl_instantaneo)
  )
)

knitr::kable(
  indicadores,
  col.names = c("Indicador", "Valor"),
  caption = "Indicadores do cenário instantâneo"
)
```

---

# Comparativo: Investimento vs. Benefício

```{r}
#| label: comparativo

retorno <- beneficio_saude_anual / investimento_fixacao_anual

comparativo <- data.frame(
  item = c(
    "Investimento em fixação (adicional 10%)",
    "Economia em saúde (exames, encaminhamentos, internações)",
    "Saldo (economia - investimento)",
    "Retorno: para cada R$ 1 investido, economia de"
  ),
  valor = c(
    formatar_moeda(investimento_fixacao_anual),
    formatar_moeda(beneficio_saude_anual),
    formatar_moeda(saldo_anual),
    paste0("R$ ", round(retorno, 2))
  )
)

knitr::kable(
  comparativo,
  col.names = c("Item", "Valor Anual"),
  caption = "Comparativo: investimento vs. benefício"
)
```

---

# Conclusões

O cenário instantâneo demonstra que **mesmo pagando adicional de 10% para 100 médicos MFC**, o município ainda economiza porque:

1. **O benefício em saúde supera o investimento:** Para cada R$ 1,00 investido em adicional, o município economiza R$ `r round(retorno, 2)` em exames, encaminhamentos e internações.

2. **O VPL é positivo:** `r formatar_moeda(vpl_instantaneo)` em 10 anos.

3. **O saldo anual é positivo:** `r formatar_moeda(saldo_anual)` por ano.

**Limitação deste cenário:** É hipotético. Na prática, o município não consegue ter 100% de cobertura MFC instantaneamente. O programa de residência é o caminho para atingir essa cobertura gradualmente.
