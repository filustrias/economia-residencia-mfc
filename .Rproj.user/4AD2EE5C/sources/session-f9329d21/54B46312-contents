---
title: "Cálculo da Economia em Saúde"
---

# Introdução

Este capítulo calcula a economia em saúde gerada pela cobertura de médicos de família, detalhando os resultados por categoria de procedimento.

**Estrutura:**

1. Economia com encaminhamentos
2. Economia com exames
3. Economia com internações
4. Totalização e interpretação

---

# Preparação

```{r}
#| label: setup
#| include: true
#| message: false
#| warning: false

options(scipen = 999, digits = 2, OutDec = ",")

formatar_numero <- function(x, decimais = 0) {
  format(round(x, decimais), big.mark = ".", decimal.mark = ",", nsmall = decimais)
}

formatar_moeda <- function(x) {
  paste0("R$ ", formatar_numero(x))
}
```

---

# Função de Conversão para Baseline

Os dados dos estudos foram observados em uma população mista (33,6% médicos de família + 66,4% generalistas). Precisamos converter para o cenário baseline (0% médicos de família).

```{r}
#| label: funcao-conversao

converter_para_baseline <- function(valor_observado, 
                                     risco_relativo, 
                                     proporcao_mfc = 0.336, 
                                     proporcao_gen = 0.664,
                                     populacao_estudo = 600000, 
                                     populacao_alvo = 500000) {
  
  denominador <- (proporcao_mfc * risco_relativo) + proporcao_gen
  baseline_estudo <- valor_observado / denominador
  baseline_alvo <- baseline_estudo * (populacao_alvo / populacao_estudo)
  
  return(baseline_alvo)
}
```

---

# Parâmetros

```{r}
#| label: parametros

custo_consulta <- 50.00
fator_correcao_internacoes <- 1.5
```

| Parâmetro | Valor | Justificativa |
|-----------|-------|---------------|
| Custo da consulta especializada | `r formatar_moeda(custo_consulta)` | Média ponderada da tabela do Sistema Único de Saúde |
| Fator de correção para internações | `r fator_correcao_internacoes` | Corrige defasagem da tabela de internações |

---

# 1. Economia com Encaminhamentos

## Encaminhamentos Ambulatoriais

```{r}
#| label: enc-ambulatoriais

enc_ambulatoriais <- data.frame(
  especialidade = c(
    "Cardiologia", "Neurologia", "Psiquiatria", "Dermatologia",
    "Pneumologia", "Doenças infecciosas", "Urologia", "Alergologia",
    "Nefrologia", "Endocrinologia", "Gastroenterologia", "Angiologia",
    "Reumatologia", "Fisioterapia", "Reabilitação", "Oftalmologia",
    "Otorrinolaringologia", "Ortopedia", "Ginecologia", "Pré-natal alto risco"
  ),
  risco_relativo = c(
    0.40, 0.50, 0.45, 0.49, 0.54, 0.74, 0.57, 0.54,
    0.63, 0.42, 0.38, 0.35, 0.47, 1.17, 1.68, 1.09,
    0.71, 0.52, 0.86, 0.66
  ),
  observado = c(
    2008, 1835, 897, 4144, 903, 290, 1762, 480,
    603, 1021, 867, 1030, 830, 2390, 1173, 8713,
    2269, 4934, 738, 991
  ),
  stringsAsFactors = FALSE
)

# Calcular baseline e economia
enc_ambulatoriais$baseline <- mapply(converter_para_baseline, 
                                      enc_ambulatoriais$observado, 
                                      enc_ambulatoriais$risco_relativo)

enc_ambulatoriais$reducao_pct <- (1 - enc_ambulatoriais$risco_relativo) * 100

enc_ambulatoriais$eventos_evitados <- enc_ambulatoriais$baseline * 
                                       (1 - enc_ambulatoriais$risco_relativo)

enc_ambulatoriais$economia <- enc_ambulatoriais$eventos_evitados * custo_consulta
```

### Especialidades com Maior Economia

```{r}
#| label: tabela-enc-amb-top

# Ordenar por economia
enc_amb_ordenado <- enc_ambulatoriais[order(-enc_ambulatoriais$economia), ]

# Top 10
top10_amb <- enc_amb_ordenado[1:10, c("especialidade", "risco_relativo", 
                                       "eventos_evitados", "economia")]
top10_amb$reducao <- paste0(round((1 - top10_amb$risco_relativo) * 100, 0), "%")
top10_amb$economia_fmt <- formatar_moeda(top10_amb$economia)
top10_amb$eventos_fmt <- formatar_numero(top10_amb$eventos_evitados)

knitr::kable(
  top10_amb[, c("especialidade", "reducao", "eventos_fmt", "economia_fmt")],
  col.names = c("Especialidade", "Redução", "Consultas Evitadas/ano", "Economia/ano"),
  caption = "10 especialidades ambulatoriais com maior economia"
)
```

### Especialidades com Aumento de Encaminhamentos

Algumas especialidades apresentam risco relativo maior que 1, indicando que médicos de família encaminham **mais** para estas áreas:

```{r}
#| label: tabela-enc-amb-aumento

enc_aumento <- enc_ambulatoriais[enc_ambulatoriais$risco_relativo > 1, 
                                  c("especialidade", "risco_relativo", "economia")]
enc_aumento$aumento <- paste0("+", round((enc_aumento$risco_relativo - 1) * 100, 0), "%")
enc_aumento$custo_adicional <- formatar_moeda(-enc_aumento$economia)

knitr::kable(
  enc_aumento[, c("especialidade", "aumento", "custo_adicional")],
  col.names = c("Especialidade", "Aumento", "Custo Adicional/ano"),
  caption = "Especialidades com aumento de encaminhamentos"
)
```

**Interpretação:** Médicos de família encaminham mais para Fisioterapia, Reabilitação e Oftalmologia. Isso pode indicar melhor identificação de necessidades nestas áreas.

### Total de Encaminhamentos Ambulatoriais

```{r}
#| label: total-enc-amb

economia_enc_amb <- sum(enc_ambulatoriais$economia)
```

**Economia total com encaminhamentos ambulatoriais:** `r formatar_moeda(economia_enc_amb)` por ano

---

## Encaminhamentos Cirúrgicos

```{r}
#| label: enc-cirurgicos

enc_cirurgicos <- data.frame(
  especialidade = c(
    "Cirurgia geral", "Cirurgia vascular", "Neurocirurgia",
    "Proctologia", "Cirurgia de cabeça e pescoço", "Mastologia"
  ),
  risco_relativo = c(1.21, 0.87, 1.22, 0.91, 1.19, 0.87),
  observado = c(4458, 989, 147, 1968, 859, 359),
  stringsAsFactors = FALSE
)

enc_cirurgicos$baseline <- mapply(converter_para_baseline, 
                                   enc_cirurgicos$observado, 
                                   enc_cirurgicos$risco_relativo)

enc_cirurgicos$eventos_evitados <- enc_cirurgicos$baseline * 
                                    (1 - enc_cirurgicos$risco_relativo)

enc_cirurgicos$economia <- enc_cirurgicos$eventos_evitados * custo_consulta

enc_cirurgicos$efeito <- ifelse(enc_cirurgicos$risco_relativo < 1, 
                                 paste0("-", round((1 - enc_cirurgicos$risco_relativo) * 100, 0), "%"),
                                 paste0("+", round((enc_cirurgicos$risco_relativo - 1) * 100, 0), "%"))

enc_cirurgicos$economia_fmt <- ifelse(enc_cirurgicos$economia >= 0,
                                       formatar_moeda(enc_cirurgicos$economia),
                                       paste0("(", formatar_moeda(-enc_cirurgicos$economia), ")"))

knitr::kable(
  enc_cirurgicos[, c("especialidade", "efeito", "economia_fmt")],
  col.names = c("Especialidade Cirúrgica", "Efeito", "Economia/ano"),
  caption = "Encaminhamentos cirúrgicos (valores negativos entre parênteses)"
)
```

```{r}
#| label: total-enc-cir

economia_enc_cir <- sum(enc_cirurgicos$economia)
```

**Economia total com encaminhamentos cirúrgicos:** `r formatar_moeda(economia_enc_cir)` por ano

**Nota:** O valor negativo indica que médicos de família geram custo adicional nesta categoria, principalmente por encaminharem mais para cirurgia geral, neurocirurgia e cirurgia de cabeça e pescoço.

---

## Total de Encaminhamentos

```{r}
#| label: total-encaminhamentos

economia_encaminhamentos <- economia_enc_amb + economia_enc_cir
```

| Categoria | Economia Anual |
|-----------|----------------|
| Encaminhamentos ambulatoriais | `r formatar_moeda(economia_enc_amb)` |
| Encaminhamentos cirúrgicos | `r formatar_moeda(economia_enc_cir)` |
| **Total encaminhamentos** | **`r formatar_moeda(economia_encaminhamentos)`** |

---

# 2. Economia com Exames

## Exames Diagnósticos

```{r}
#| label: exames-diagnosticos

exames_diag <- data.frame(
  exame = c(
    "Ecocardiograma", "Eletroencefalograma", "Endoscopia digestiva",
    "Ultrassonografia", "Radiografia", "Outros diagnósticos"
  ),
  risco_relativo = c(0.66, 0.96, 0.76, 0.49, 0.72, 0.98),
  observado = c(1201, 385, 510, 1090, 431, 2424),
  custo = c(39.94, 13.20, 86.00, 48.16, 30.00, 45.00),
  stringsAsFactors = FALSE
)

exames_diag$baseline <- mapply(converter_para_baseline, 
                                exames_diag$observado, 
                                exames_diag$risco_relativo)

exames_diag$eventos_evitados <- exames_diag$baseline * (1 - exames_diag$risco_relativo)
exames_diag$economia <- exames_diag$eventos_evitados * exames_diag$custo

exames_diag$reducao <- paste0(round((1 - exames_diag$risco_relativo) * 100, 0), "%")
exames_diag$economia_fmt <- formatar_moeda(exames_diag$economia)

knitr::kable(
  exames_diag[, c("exame", "reducao", "economia_fmt")],
  col.names = c("Exame Diagnóstico", "Redução", "Economia/ano"),
  caption = "Economia com exames diagnósticos"
)
```

```{r}
#| label: total-diag

economia_diag <- sum(exames_diag$economia)
```

**Economia total com exames diagnósticos:** `r formatar_moeda(economia_diag)` por ano

---

## Exames Laboratoriais

```{r}
#| label: exames-laboratoriais

exames_lab <- data.frame(
  exame = c(
    "Hemograma", "Glicemia jejum", "Colesterol total", "Colesterol HDL",
    "Colesterol LDL", "Triglicerídeos", "Creatinina", "Ureia",
    "Transaminase TGO", "Transaminase TGP", "Gama GT", "Bilirrubinas",
    "Ácido úrico", "Hormônio TSH", "Hormônio T4 livre", "Antígeno PSA",
    "Hemoglobina glicada", "Glicemia pós-prandial", "Curva glicêmica", "Frutosamina",
    "Sódio", "Potássio", "Cálcio", "Urina tipo 1",
    "Urocultura", "Vitamina D", "Vitamina B12", "Ferritina",
    "Ferro sérico", "Fosfatase alcalina"
  ),
  risco_relativo = c(
    0.53, 0.85, 0.29, 0.42, 0.73, 0.46, 0.64, 0.81,
    0.94, 0.41, 0.82, 0.23, 0.71, 0.08, 0.13, 0.56,
    0.78, 0.48, 0.47, 0.69, 0.64, 0.74, 0.09, 0.67,
    0.44, 0.56, 0.60, 0.48, 0.47, 0.36
  ),
  observado = c(
    51757, 43746, 22577, 10517, 18265, 9072, 25720, 34673,
    31127, 22163, 33828, 15603, 11679, 791, 886, 5432,
    2304, 9181, 9363, 3505, 4386, 1957, 604, 41333,
    1866, 674, 863, 210, 216, 4365
  ),
  custo = c(
    4.11, 1.85, 1.85, 1.85, 1.85, 1.85, 7.86, 1.85,
    3.51, 3.51, 3.51, 1.85, 8.96, 8.71, 8.71, 11.60,
    2.01, 2.01, 2.01, 2.01, 3.51, 2.63, 1.65, 3.70,
    1.85, 10.15, 10.15, 18.55, 18.55, 16.42
  ),
  stringsAsFactors = FALSE
)

exames_lab$baseline <- mapply(converter_para_baseline, 
                               exames_lab$observado, 
                               exames_lab$risco_relativo)

exames_lab$eventos_evitados <- exames_lab$baseline * (1 - exames_lab$risco_relativo)
exames_lab$economia <- exames_lab$eventos_evitados * exames_lab$custo
```

### Exames com Maior Redução

```{r}
#| label: tabela-lab-top-reducao

# Ordenar por risco relativo (menor = maior redução)
lab_ordenado <- exames_lab[order(exames_lab$risco_relativo), ]

top10_reducao <- lab_ordenado[1:10, c("exame", "risco_relativo", "economia")]
top10_reducao$reducao <- paste0(round((1 - top10_reducao$risco_relativo) * 100, 0), "%")
top10_reducao$economia_fmt <- formatar_moeda(top10_reducao$economia)

knitr::kable(
  top10_reducao[, c("exame", "reducao", "economia_fmt")],
  col.names = c("Exame", "Redução", "Economia/ano"),
  caption = "10 exames laboratoriais com maior redução percentual"
)
```

### Exames com Maior Economia Absoluta

```{r}
#| label: tabela-lab-top-economia

lab_por_economia <- exames_lab[order(-exames_lab$economia), ]

top10_economia <- lab_por_economia[1:10, c("exame", "risco_relativo", "economia")]
top10_economia$reducao <- paste0(round((1 - top10_economia$risco_relativo) * 100, 0), "%")
top10_economia$economia_fmt <- formatar_moeda(top10_economia$economia)

knitr::kable(
  top10_economia[, c("exame", "reducao", "economia_fmt")],
  col.names = c("Exame", "Redução", "Economia/ano"),
  caption = "10 exames laboratoriais com maior economia absoluta"
)
```

```{r}
#| label: total-lab

economia_lab <- sum(exames_lab$economia)
```

**Economia total com exames laboratoriais:** `r formatar_moeda(economia_lab)` por ano

---

## Total de Exames

```{r}
#| label: total-exames

economia_exames <- economia_diag + economia_lab
```

| Categoria | Economia Anual |
|-----------|----------------|
| Exames diagnósticos | `r formatar_moeda(economia_diag)` |
| Exames laboratoriais | `r formatar_moeda(economia_lab)` |
| **Total exames** | **`r formatar_moeda(economia_exames)`** |

---

# 3. Economia com Internações

As internações evitáveis (condições sensíveis à atenção primária) representam hospitalizações que poderiam ser prevenidas com atenção primária de qualidade.

```{r}
#| label: internacoes

internacoes <- data.frame(
  condicao = c(
    "Doenças preveníveis por vacina", "Gastroenterites", "Anemia",
    "Deficiências nutricionais", "Infecções de ouvido e vias aéreas",
    "Pneumonias bacterianas", "Asma", "Doenças pulmonares",
    "Hipertensão", "Angina", "Insuficiência cardíaca",
    "Doenças cerebrovasculares", "Diabetes", "Epilepsias"
  ),
  risco_relativo = c(
    0.83, 0.76, 0.74, 0.62, 0.52, 0.79, 0.35, 0.78,
    0.45, 0.57, 0.36, 0.82, 1.06, 0.59
  ),
  observado = c(
    128, 160, 244, 271, 230, 86, 54, 136,
    45, 114, 116, 331, 28, 41
  ),
  custo = c(
    761.35, 1178.17, 1756.62, 4774.49, 2553.91, 957.47, 853.21, 646.69,
    527.15, 1969.07, 1969.07, 679.82, 502.60, 612.67
  ),
  stringsAsFactors = FALSE
)

internacoes$baseline <- mapply(converter_para_baseline, 
                                internacoes$observado, 
                                internacoes$risco_relativo)

internacoes$eventos_evitados <- internacoes$baseline * (1 - internacoes$risco_relativo)

# Aplicar fator de correção
internacoes$economia <- internacoes$eventos_evitados * 
                         internacoes$custo * 
                         fator_correcao_internacoes

internacoes$reducao <- ifelse(
  internacoes$risco_relativo <= 1,
  paste0(round((1 - internacoes$risco_relativo) * 100, 0), "%"),
  paste0("+", round((internacoes$risco_relativo - 1) * 100, 0), "%")
)

internacoes$economia_fmt <- ifelse(
  internacoes$economia >= 0,
  formatar_moeda(internacoes$economia),
  paste0("(", formatar_moeda(-internacoes$economia), ")")
)
```

### Condições com Maior Redução de Internações

```{r}
#| label: tabela-internacoes

# Ordenar por economia
int_ordenado <- internacoes[order(-internacoes$economia), ]

knitr::kable(
  int_ordenado[, c("condicao", "reducao", "economia_fmt")],
  col.names = c("Condição", "Redução", "Economia/ano"),
  caption = "Economia com internações evitáveis (com fator de correção 1,5)"
)
```

```{r}
#| label: total-internacoes

economia_internacoes <- sum(internacoes$economia)
```

**Economia total com internações:** `r formatar_moeda(economia_internacoes)` por ano

**Destaques:**

- **Asma:** Redução de 65% nas internações
- **Insuficiência cardíaca:** Redução de 64% nas internações
- **Hipertensão:** Redução de 55% nas internações
- **Diabetes:** Único grupo com aumento (6%), mas não estatisticamente significativo

---

# 4. Totalização

## Economia Total com 100% de Cobertura

```{r}
#| label: totalizacao

economia_total <- economia_encaminhamentos + economia_exames + economia_internacoes

resumo <- data.frame(
  categoria = c("Encaminhamentos", "Exames", "Internações", "TOTAL"),
  economia = c(economia_encaminhamentos, economia_exames, economia_internacoes, economia_total),
  stringsAsFactors = FALSE
)

resumo$percentual <- resumo$economia / economia_total * 100
resumo$economia_fmt <- formatar_moeda(resumo$economia)
resumo$pct_fmt <- paste0(round(resumo$percentual, 1), "%")

knitr::kable(
  resumo[, c("categoria", "economia_fmt", "pct_fmt")],
  col.names = c("Categoria", "Economia Anual", "Percentual"),
  caption = "Economia total em saúde com 100% de cobertura por médicos de família"
)
```

## Interpretação

A economia total de **`r formatar_moeda(economia_total)`** por ano representa o potencial máximo se todas as 100 equipes do município fossem cobertas por médicos de família.

**Composição da economia:**

- **Internações (`r round(economia_internacoes / economia_total * 100, 0)`%):** A maior parte da economia vem da prevenção de hospitalizações evitáveis. Médicos de família conseguem manejar melhor condições crônicas como hipertensão, insuficiência cardíaca e asma, evitando descompensações que levam a internações.

- **Encaminhamentos (`r round(economia_encaminhamentos / economia_total * 100, 0)`%):** Médicos de família resolvem mais problemas na atenção primária, reduzindo a necessidade de consultas com especialistas. A maior economia está em cardiologia, endocrinologia e ortopedia.

- **Exames (`r round(economia_exames / economia_total * 100, 0)`%):** Médicos de família solicitam exames de forma mais racional, evitando pedidos desnecessários. As maiores reduções estão em exames hormonais (TSH, T4) e perfil lipídico.

---

# Função Consolidada

Para uso nos capítulos seguintes, consolidamos o cálculo em uma única função:

```{r}
#| label: funcao-consolidada

calcular_economia_saude <- function(fator_correcao = 1.5) {
  #' Calcula a economia total em saúde com 100% de cobertura
  #'
  #' @param fator_correcao Fator de correção para internações
  #' @return Lista com economia por categoria e total
  
  # Os cálculos já foram feitos acima, apenas retornamos os resultados
  # Em uso real, esta função conteria todos os data.frames e cálculos
  
  return(list(
    encaminhamentos = economia_encaminhamentos,
    exames = economia_exames,
    internacoes = economia_internacoes,
    total = economia_total
  ))
}

# Verificar
resultado <- calcular_economia_saude(1.5)
```

---

# Resumo

Este capítulo calculou a economia em saúde que seria gerada se todas as equipes do município fossem cobertas por médicos de família:

| Categoria | Economia Anual | Percentual |
|-----------|----------------|------------|
| Encaminhamentos | `r formatar_moeda(economia_encaminhamentos)` | `r round(economia_encaminhamentos / economia_total * 100, 1)`% |
| Exames | `r formatar_moeda(economia_exames)` | `r round(economia_exames / economia_total * 100, 1)`% |
| Internações | `r formatar_moeda(economia_internacoes)` | `r round(economia_internacoes / economia_total * 100, 1)`% |
| **Total** | **`r formatar_moeda(economia_total)`** | **100%** |

**Próximo capítulo:** Utilizaremos este valor para calcular os indicadores econômicos do programa de residência, considerando que a cobertura aumenta gradualmente ao longo dos 10 anos.
